"use strict";(self.webpackChunkwiki=self.webpackChunkwiki||[]).push([[2531],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),g=u(n),m=a,d=g["".concat(s,".").concat(m)]||g[m]||c[m]||o;return n?r.createElement(d,i(i({ref:t},p),{},{components:n})):r.createElement(d,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=g;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"},85264:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var r=n(87462),a=(n(67294),n(3905));const o={layout:"post",title:"\u57fa\u4e8eServlet\u4f53\u7cfb\u7684HTTP\u8bf7\u6c42\u4ee3\u7406\u8f6c\u53d1Spring Boot\u7ec4\u4ef6",categories:"Spring Boot",description:"\u57fa\u4e8eServlet\u4f53\u7cfb\u7684HTTP\u8bf7\u6c42\u4ee3\u7406\u8f6c\u53d1Spring Boot\u7ec4\u4ef6",keywords:["Spring Boot","Servlet\u8f6c\u53d1","HTTP\u8bf7\u6c42\u4ee3\u7406"]},i=void 0,l={unversionedId:"springboot/2021-02-03-spring-boot-servlet-gateway-compoents",id:"springboot/2021-02-03-spring-boot-servlet-gateway-compoents",title:"\u57fa\u4e8eServlet\u4f53\u7cfb\u7684HTTP\u8bf7\u6c42\u4ee3\u7406\u8f6c\u53d1Spring Boot\u7ec4\u4ef6",description:"\u57fa\u4e8eServlet\u4f53\u7cfb\u7684HTTP\u8bf7\u6c42\u4ee3\u7406\u8f6c\u53d1Spring Boot\u7ec4\u4ef6",source:"@site/programmer/blog/springboot/2021-02-03-spring-boot-servlet-gateway-compoents.md",sourceDirName:"springboot",slug:"/springboot/2021-02-03-spring-boot-servlet-gateway-compoents",permalink:"/blog/springboot/2021-02-03-spring-boot-servlet-gateway-compoents",draft:!1,editUrl:"https://github.com/xiaoymin/blog-ai/blob/master/programmer/blog/springboot/2021-02-03-spring-boot-servlet-gateway-compoents.md",tags:[],version:"current",lastUpdatedBy:"xiaoyumin",lastUpdatedAt:1686478303,formattedLastUpdatedAt:"2023\u5e746\u670811\u65e5",frontMatter:{layout:"post",title:"\u57fa\u4e8eServlet\u4f53\u7cfb\u7684HTTP\u8bf7\u6c42\u4ee3\u7406\u8f6c\u53d1Spring Boot\u7ec4\u4ef6",categories:"Spring Boot",description:"\u57fa\u4e8eServlet\u4f53\u7cfb\u7684HTTP\u8bf7\u6c42\u4ee3\u7406\u8f6c\u53d1Spring Boot\u7ec4\u4ef6",keywords:["Spring Boot","Servlet\u8f6c\u53d1","HTTP\u8bf7\u6c42\u4ee3\u7406"]},sidebar:"tutorialSidebar",previous:{title:"Spring Boot\u81ea\u5b9a\u4e49starter\u5fc5\u77e5\u5fc5\u4f1a\u6761\u4ef6",permalink:"/blog/springboot/2020-12-10-spring-boot-self-starter"},next:{title:"Spring Boot\u6846\u67b6\u4e2d\u9488\u5bf9\u6570\u636e\u6587\u4ef6\u6a21\u677f\u7684\u4e0b\u8f7d\u603b\u7ed3",permalink:"/blog/springboot/2021-03-03-spring-boot-common-file-download"}},s={},u=[{value:"\u80cc\u666f\u6982\u8ff0",id:"\u80cc\u666f\u6982\u8ff0",level:2},{value:"\u6e38\u5ba2\u7aef(\u5c0f\u7a0b\u5e8f\u7aef)",id:"\u6e38\u5ba2\u7aef\u5c0f\u7a0b\u5e8f\u7aef",level:3},{value:"\u7ba1\u7406\u7aef(PC\u7aef)",id:"\u7ba1\u7406\u7aefpc\u7aef",level:3},{value:"\u7a0b\u5e8f\u8bbe\u8ba1",id:"\u7a0b\u5e8f\u8bbe\u8ba1",level:2},{value:"\u4f7f\u7528\u6307\u5357",id:"\u4f7f\u7528\u6307\u5357",level:2}],p={toc:u};function c(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u80cc\u666f\u6982\u8ff0"},"\u80cc\u666f\u6982\u8ff0"),(0,a.kt)("p",null,"\u4e24\u4e2a\u9879\u76ee\u7ec4\u539f\u672c\u90fd\u662f\u5404\u81ea\u8d1f\u8d23\u4e24\u4e2a\u4ea7\u54c1\u7ebf(",(0,a.kt)("strong",{parentName:"p"},"\u4ea7\u54c1A"),"\u3001",(0,a.kt)("strong",{parentName:"p"},"\u4ea7\u54c1B"),")\uff0c\u7531\u4e8e\u516c\u53f8\u4e1a\u52a1\u7684\u53d1\u5c55\uff0c\u76ee\u524d\u9700\u8981\u5c06\u4e24\u4e2a\u4ea7\u54c1\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u4ea7\u54c1(\u529f\u80fd\u6574\u5408\uff0c\u90e8\u5206\u505a\u53d6\u820d,\u6700\u7ec8\u4ea7\u51fa",(0,a.kt)("strong",{parentName:"p"},"\u4ea7\u54c1C"),")\uff0c\u524d\u540e\u7aef\u4ee3\u7801\u5fc5\u7136\u4e5f\u9700\u8981\u6574\u5408\uff0c\u5305\u62ec\u4e24\u4e2a\u4ea7\u54c1\u7ebf\u7684\u7528\u6237\u4f53\u7cfb\u7b49\u3002\u5e76\u4e14\u7ed9\u51fa\u7684",(0,a.kt)("strong",{parentName:"p"},"\u65f6\u95f4\u8282\u70b9\u5f88\u7d27\u5f20"),"\u3002"),(0,a.kt)("p",null,"\u76ee\u524d\u4e24\u4e2a\u4ea7\u54c1\u7ebf\u7684\u533a\u522b\u70b9\uff1a"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4ea7\u54c1A")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u524d\u7aef\u6a21\u5757\u8f7d\u4f53\u662f\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\uff0c\u6ca1\u6709H5\u3001APP\u7b49\u9700\u6c42\uff0c\u56e0\u6b64\u6240\u91c7\u7528\u7684\u6280\u672f\u6808\u662f\u539f\u751f\u5199\u6cd5\uff0c\u6ca1\u6709\u7528\u5230\u6280\u672f\u6846\u67b6"),(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u7aef\u6280\u672f\u67b6\u6784\u662f\u5355\u4f53\u67b6\u6784\uff0cSpring Boot\u6846\u67b6\uff0c\u7ba1\u7406\u540e\u53f0\u6846\u67b6\u91c7\u7528\u7684\u662fApache Shiro"),(0,a.kt)("li",{parentName:"ul"},"\u524d\u540e\u7aef\u63a5\u53e3\u8c03\u7528\u91c7\u7528\u7684\u662f\u670d\u52a1\u7aef",(0,a.kt)("inlineCode",{parentName:"li"},"token"),"\u9274\u6743\u7684\u65b9\u5f0f\u4ea4\u4e92"),(0,a.kt)("li",{parentName:"ul"},"\u7528\u6237\u4f53\u7cfb\u7b80\u5355,\u5c0f\u7a0b\u5e8f\u7aef\u6ca1\u6709\u4f1a\u5458\u7b49\u4e1a\u52a1\uff0c\u4ec5\u6d89\u53ca\u5230\u5fae\u4fe1openid\uff0c\u7ba1\u7406\u540e\u53f0\u6d89\u53ca\u6743\u9650\u83dc\u5355."),(0,a.kt)("li",{parentName:"ul"},"\u540e\u7aef\u7ba1\u7406\u7cfb\u7edf\u524d\u7aef\u5f00\u53d1\u6280\u672f\u6846\u67b6\u662fReact")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4ea7\u54c1B")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u524d\u7aef\u6a21\u5757\u8f7d\u4f53\u591a\u6837\uff0c\u5305\u62ec\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u3001H5\u3001APP\u7b49\uff0c\u56e0\u6b64\u91c7\u7528\u7684\u662f\u591a\u7aef\u7edf\u4e00\u6846\u67b6\uff0c\u4f8b\u5982\uff1aunion-app"),(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u7aef\u6280\u672f\u67b6\u6784\u5355\u4f53\u67b6\u6784\uff0cSpring Boot\u6846\u67b6"),(0,a.kt)("li",{parentName:"ul"},"\u524d\u540e\u7aef\u63a5\u53e3\u8c03\u7528\u91c7\u7528\u7684\u662f\u670d\u52a1\u7aef",(0,a.kt)("inlineCode",{parentName:"li"},"token"),"\u9274\u6743\u7684\u65b9\u5f0f\u4ea4\u4e92"),(0,a.kt)("li",{parentName:"ul"},"\u7528\u6237\u4f53\u7cfb\u590d\u6742\uff0c\u6709\u4f1a\u5458\u3001\u4f18\u60e0\u5238\u7b49\u4e1a\u52a1\uff0c\u7ba1\u7406\u540e\u53f0\u6d89\u53ca\u6743\u9650\u83dc\u5355"),(0,a.kt)("li",{parentName:"ul"},"\u540e\u7aef\u7ba1\u7406\u7cfb\u7edf\u524d\u7aef\u5f00\u53d1\u6280\u672f\u6846\u67b6\u662fVue")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4ea7\u54c1C")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u8f7d\u4f53\u662f\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\uff0c\u6ca1\u6709H5\u3001APP\u7b49\u9700\u6c42"),(0,a.kt)("li",{parentName:"ul"},"\u4ea7\u54c1A\u4e2d\u7684\u529f\u80fd\u5c45\u591a,\u4ea7\u54c1B\u4e2d\u7684\u529f\u80fd\u5360\u7528\u5c11\u90e8\u5206")),(0,a.kt)("p",null,"\u9274\u4e8e\u4e0a\u9762\u7684\u80cc\u666f\uff0c\u6211\u4eec\u8ba8\u8bba\u63a5\u4e0b\u6765\u4ea7\u54c1\u7ebf\u5408\u5e76\u7684\u53ef\u80fd\u6027"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u524d\u7aef\u4ee3\u7801\u91cd\u5199\uff0c\u867d\u8bf4\u662f\u4ea7\u54c1\u7ebf\u5408\u5e76\uff0c\u4f46\u662f\u539f\u6765\u4e24\u4e2a\u4ea7\u54c1\u7ebf\u7684\u529f\u80fd\u70b9\u53ea\u662f\u505a\u6574\u5408\uff0c\u5e76\u6ca1\u6709\u592a\u591a\u65b0\u589e\u7684\u529f\u80fd\uff0c\u56e0\u6b64\u539f\u6765\u7684\u90e8\u5206\u529f\u80fd\u6a21\u5757\u53ef\u4ee5\u590d\u7528\uff0c\u91c7\u7528\u539f\u751f\u5199\u6cd5\uff0c\u4e0d\u7528\u591a\u7aef\u6846\u67b6"),(0,a.kt)("li",{parentName:"ul"},"\u540e\u7aef\u7528\u6237\u4f53\u7cfb\u590d\u7528\u4ea7\u54c1B\u4e2d\u7684\u4f53\u7cfb\uff0c\u57fa\u672c\u63a7\u5236\u83dc\u5355\u6743\u9650\u5373\u53ef"),(0,a.kt)("li",{parentName:"ul"},"\u8003\u8651\u5230\u65f6\u95f4\u7d27\u8feb\uff0c\u56e0\u6b64\u539f\u672c\u4ea7\u54c1A\\B\u4e24\u4e2a\u4ea7\u54c1\u7ebf\u7684\u5df2\u6709\u7684\u529f\u80fd\u57fa\u672c\u4e0d\u52a8\uff0c\u53ea\u5bf9\u65b0\u589e\u6a21\u5757\u7684\u529f\u80fd\u8fdb\u884c\u5f00\u53d1\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u4ea7\u54c1B\u7684\u540e\u7aef\u7cfb\u7edf\u529f\u80fd\u83dc\u5355\u3001\u6743\u9650\u7cfb\u7edf\u8f83A\u5b8c\u5584\uff0c\u56e0\u6b64\u4f5c\u4e3a\u4ea7\u54c1C\u7684\u7ba1\u7406\u540e\u7aef\u8fdb\u884c\u590d\u7528\uff0c\u5c06\u4ea7\u54c1A\u7684\u540e\u7aef\u529f\u80fd\u5168\u90e8\u79fb\u52a8\u5230\u4ea7\u54c1C\u4e2d\uff0c\u7531\u4e8e\u4e24\u4e2a\u4ea7\u54c1\u7ebf\u7ba1\u7406\u540e\u53f0\u5f00\u53d1\u7684\u6280\u672f\u6808\u4e0d\u4e00\u6837\uff0c\u56e0\u6b64\u4ea7\u54c1C\u4e2d\u7684\u90e8\u5206\u529f\u80fd\u9700\u8981\u91cd\u5199\uff0c\u5c06\u4ea7\u54c1A\u7684\u529f\u80fd\u4f7f\u7528Vue\u7684\u6280\u672f\u6808\u79fb\u5230\u4ea7\u54c1C\u4e2d")),(0,a.kt)("h3",{id:"\u6e38\u5ba2\u7aef\u5c0f\u7a0b\u5e8f\u7aef"},"\u6e38\u5ba2\u7aef(\u5c0f\u7a0b\u5e8f\u7aef)"),(0,a.kt)("p",null,"\u9488\u5bf9\u4ea7\u54c1C\u7684\u5c0f\u7a0b\u5e8f\u7aef\uff0c\u7531\u4e8e\u9700\u8981\u5305\u542b\u4ea7\u54c1A\u4e2d\u7684\u67d0\u4e00\u6838\u5fc3\u529f\u80fd\uff0c\u56e0\u6b64\u4e0d\u592a\u53ef\u80fd\u4f7f\u7528\u591a\u7aef\u6846\u67b6\u8fdb\u884c\u91cd\u5199(PS:\u4e3b\u8981\u662f\u9886\u5bfc\u7ed9\u7684\u65f6\u95f4\u4e0d\u591f)\uff0c\u56e0\u6b64\u91c7\u7528\u7684\u505a\u6cd5\u662f\u76f4\u63a5\u5728\u4ea7\u54c1A\u7684\u57fa\u7840\u4e0a\u884d\u751f\u4e00\u4e2a\u7248\u672c\uff0c\u6700\u7ec8\u5c06\u4ea7\u54c1B\u4e2d\u7684\u90e8\u5206\u529f\u80fd\uff0c\u901a\u8fc7\u539f\u751f\u6846\u67b6\uff0c\u6700\u7ec8\u5728\u4ea7\u54c1C\u4e2d\u8fdb\u884c\u5448\u73b0\u3002"),(0,a.kt)("p",null,"\u56e0\u4e3a\u5c0f\u7a0b\u5e8f\u7684\u63a5\u53e3\u8c03\u7528\u65b9\u5f0f\u662f\u76f4\u8fde\uff0c\u901a\u8fc7\u53d1\u8d77",(0,a.kt)("inlineCode",{parentName:"p"},"HTTPS"),"\u7684\u63a5\u53e3\u8bf7\u6c42\u5373\u53ef,\u56e0\u6b64\u670d\u52a1\u7aef\u63a5\u53e3\u903b\u8f91\u4e0d\u52a8\uff0c\u524d\u7aef\u5f00\u53d1\u4eba\u5458\u53ea\u9700\u8981\u548c\u4ea7\u54c1B\u7684\u4eba\u5458\u8fdb\u884c\u63a5\u53e3\u5bf9\u63a5\u5373\u53ef\uff0c\u6700\u7ec8\u63a5\u53e3\u8c03\u7528\u6d41\u7a0b\u793a\u610f\u56fe\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(79737).Z,width:"421",height:"331"})),(0,a.kt)("h3",{id:"\u7ba1\u7406\u7aefpc\u7aef"},"\u7ba1\u7406\u7aef(PC\u7aef)"),(0,a.kt)("p",null,"\u7ba1\u7406\u7aef\u5219\u4e0d\u540c\uff0c\u7531\u4e8e\u662f\u4f7f\u7528\u7684\u4ea7\u54c1B\u4e2d\u7684\u540e\u53f0\uff0c\u56e0\u6b64\u4ea7\u54c1A\u4e2d\u7684\u6743\u9650\u63a7\u5236\u9700\u8981\u53bb\u9664(\u4f8b\u5982\u767b\u5f55\u540e\u624d\u80fd\u8c03\u7528\u63a5\u53e3\u7b49\u9650\u5236),\u800c\u4ea7\u54c1A\u4e2d\u7684\u63a5\u53e3\u6743\u9650\u63a7\u5236\u9700\u8981\u4ea4\u7ed9B\u6765\u7ba1\uff0c\u53d1\u9001\u8bf7\u6c42\u65f6\u9700\u8981\u6821\u9a8c\u5f53\u524d\u8bf7\u6c42\u7684\u6743\u9650\uff0c\u6821\u9a8c\u901a\u8fc7\u540e\u518d\u8f6c\u53d1\u7ed9A\uff0c\u8c03\u7528\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(61255).Z,width:"801",height:"561"})),(0,a.kt)("p",null,"\u4e0a\u9762\u8fd9\u5f20\u56fe\u4e5f\u662f\u8fd9\u4e2a\u7ec4\u4ef6\u96cf\u5f62\uff0c\u5bc4\u5e0c\u671b\u4e0e\u901a\u8fc7\u8be5\u8f6c\u53d1\u7ec4\u4ef6,\u901a\u8fc7\u63d0\u4f9b\u4e0d\u540c\u7684\u8f6c\u53d1\u65b9\u5f0f\uff0c\u5c01\u88c5\u8f6c\u53d1HTTP\u8bf7\u6c42\u7684\u80fd\u529b\uff0c\u8fbe\u5230\u76f4\u8fde\u670d\u52a1\u7684\u76ee\u7684"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u5355\u7eaf\u4ece\u4e00\u4e2a\u65b0\u4ea7\u54c1C\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"ServiceA"),"\u4e2d\u7684\u670d\u52a1\u63a5\u53e3\u4ee3\u7801\u5e94\u8be5\u5408\u5e76\u5230",(0,a.kt)("inlineCode",{parentName:"p"},"ServiceB"),"\uff0c\u6700\u7ec8\u5f62\u6210\u4e00\u4e2a\u65b0\u7684",(0,a.kt)("inlineCode",{parentName:"p"},"ServiceC"),"\uff0c\u4f46\u662f\u8003\u8651\u5230\u65f6\u95f4\u7d27\u8feb\uff0c\u6240\u4ee5\u4ee3\u7801\u5c42\u9762\u7684\u5408\u5e76\u5e76\u6ca1\u6709\u5f62\u6210\uff0c\u56e0\u6b64\u8003\u8651\u76f4\u63a5\u5c06\u8bf7\u6c42HTTP\u8f6c\u53d1\u7684\u65b9\u5f0f\uff0c\u6700\u7ec8\u5c06\u4efb\u52a1\u5b8c\u6210\u3002")),(0,a.kt)("h2",{id:"\u7a0b\u5e8f\u8bbe\u8ba1"},"\u7a0b\u5e8f\u8bbe\u8ba1"),(0,a.kt)("p",null,"\u4ece\u9700\u6c42\u80cc\u666f\u51fa\u53d1\uff0c\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u4e0a\u9700\u8981\u8003\u8651\u7684\u51e0\u4e2a\u70b9\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e0a\u6e38\u670d\u52a1\u63a5\u6536\u5230\u7684\u56fa\u5b9a\u8bf7\u6c42\u5934\uff0c\u6216\u8005\u8bf7\u6c42\u53c2\u6570\uff0c\u6bd4\u5982\u591a\u79df\u6237\u7cfb\u7edf\u9700\u8981\u63a5\u6536\u4e00\u4e2a\u79df\u6237\u7684\u8bf7\u6c42header\uff0c\u56e0\u6b64\u8f6c\u53d1\u7ec4\u4ef6\u9700\u8981\u6709\u914d\u7f6e\u56fa\u5b9aheader\u7684\u80fd\u529b\uff0c\u4ee5\u4fbf\u5728\u5b9e\u9645\u8f6c\u53d1\u8fc7\u7a0b\u4e2d\u53d1\u9001\u5230\u4e0b\u6e38\u670d\u52a1\uff0c\u65b9\u4fbf\u7cfb\u7edf\u6269\u5c55"),(0,a.kt)("li",{parentName:"ul"},"\u9700\u8981\u63d0\u4f9b\u6743\u9650\u9a8c\u8bc1\u7684\u63a5\u53e3\uff0c\u4e0d\u540c\u7684\u6743\u9650\u6846\u67b6\u53ef\u80fd\u9a8c\u8bc1\u65b9\u5f0f\u4e0d\u540c\uff0c\u6709\u4e9b\u7cfb\u7edf\u662f",(0,a.kt)("inlineCode",{parentName:"li"},"Shiro"),"\uff0c\u6216\u8005",(0,a.kt)("inlineCode",{parentName:"li"},"Spring Security"),",\u6216\u8005\u81ea\u7814\uff0c\u56e0\u6b64\u5728\u6700\u7ec8\u6743\u9650\u6821\u9a8c\u65f6\uff0c\u8003\u8651\u5230\u548c\u7cfb\u7edf\u7684\u517c\u5bb9\u6027\uff0c\u5bf9\u4e8e\u4e0b\u6e38\u7684\u8f6c\u53d1\u670d\u52a1\u63a5\u53e3\uff0c\u9700\u8981\u63d0\u4f9b\u548c\u7cfb\u7edf\u517c\u5bb9\u7684\u9a8c\u8bc1\u63a5\u53e3\uff0c\u4e0d\u53ef\u6253\u7834\u539f\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027"),(0,a.kt)("li",{parentName:"ul"},"\u8f6c\u53d1\u7684\u65b9\u5f0f\u652f\u6301\u7c7b\u522b\uff0c\u8003\u8651\u5230\u7cfb\u7edf\u7684\u5065\u58ee\u6027\uff0c\u9700\u8981\u63d0\u4f9b\u4e0d\u540c\u7684\u8f6c\u53d1\u7c7b\u522b\u652f\u6491")),(0,a.kt)("p",null,"\u7531\u4e8e\u662f\u57fa\u4e8eServlet\u4f53\u7cfb\uff0c\u56e0\u6b64\u5bf9\u4e8e\u63a5\u53e3\u7684\u8bf7\u6c42\uff0c\u9700\u8981\u505a\u4e00\u5c42\u62e6\u622a\u5224\u65ad\uff0c\u4ee5\u9a8c\u8bc1\u5f53\u524d\u7684\u8bf7\u6c42\u662f\u5426\u662f\u9700\u8981\u8f6c\u53d1\u5230\u4e0b\u6e38\u670d\u52a1\uff0c\u6838\u5fc3\u8fc7\u6ee4\u5668\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'public class ServletGatewayRouteProxyFilter implements Filter {\n    //\u6267\u884c\u5668\u5bf9\u8c61\n    private final RouteDispatcher routeDispatcher;\n    //\u6743\u9650\u5bf9\u8c61\n    private final ServletGatewayAuthentication servletGatewayAuthentication;\n    Logger logger= LoggerFactory.getLogger(ServletGatewayRouteProxyFilter.class);\n\n    /**\n     * \u72d7\u4ed4ProxyHttpFilter \u5bf9\u8c61\u5b9e\u4f8b\n     * @param routeDispatcher \u6267\u884c\u5668\u5bf9\u8c61\n     * @param servletGatewayAuthentication \u6743\u9650\u6821\u9a8c\u5bf9\u8c61\n     */\n    public ServletGatewayRouteProxyFilter(RouteDispatcher routeDispatcher, ServletGatewayAuthentication servletGatewayAuthentication) {\n        this.routeDispatcher = routeDispatcher;\n        this.servletGatewayAuthentication = servletGatewayAuthentication;\n    }\n \n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        HttpServletRequest request= (HttpServletRequest) servletRequest;\n        HttpServletResponse response=(HttpServletResponse) servletResponse;\n        //\u6839\u636e\u7a0b\u5e8f\u914d\u7f6e\u65b9\u5f0f\uff0c\u622a\u53d6\u5f53\u524d\u8bf7\u6c42\u662f\u5426\u7b26\u5408\u8f6c\u53d1\u8bf7\u6c42\n        Optional<ServiceRoute> serviceRouteOptional=routeDispatcher.assertServletRequest(request);\n        if (serviceRouteOptional.isPresent()){\n            logger.info("\u8f6c\u53d1\u76ee\u6807\u670d\u52a1\uff0c\u5730\u5740:{}",request.getRequestURI());\n            if (servletGatewayAuthentication.required()){\n                if (servletGatewayAuthentication.auth(servletRequest,servletResponse)){\n                    routeDispatcher.execute(request,response,serviceRouteOptional.get());\n                }else{\n                    servletGatewayAuthentication.failedHandle(servletRequest,servletResponse);\n                }\n            }else{\n                routeDispatcher.execute(request,response,serviceRouteOptional.get());\n            }\n        }else{\n            //\u4e0d\u7b26\u5408\uff0c\u7ee7\u7eed\u6267\u884c\n            filterChain.doFilter(servletRequest,servletResponse);\n        }\n    }\n    \n    //other code...\n\n}\n\n')),(0,a.kt)("p",null,"\u5bf9\u4e8e\u5f53\u524d\u7684",(0,a.kt)("inlineCode",{parentName:"p"},"HttpServletRequest"),"\u4fe1\u606f\u505a\u5224\u65ad\uff0c\u83b7\u53d6\u5f53\u524d\u8bf7\u6c42\u7684",(0,a.kt)("inlineCode",{parentName:"p"},"ServiceRoute"),"\u5bf9\u8c61\uff0c\u4ee5\u6b64\u6765\u5224\u65ad\u8bf7\u6c42\u662f\u5426\u9700\u8981\u8f6c\u53d1"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"ServiceRoute"),"\u5bf9\u8c61\u4e3b\u8981\u5305\u542b\u4e0b\u6e38\u8f6c\u53d1\u670d\u52a1\u7684HTTP\u5730\u5740\u3001\u7aef\u53e3\u53f7\u3001\u56fa\u5b9aHeader\u4fe1\u606f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"public class ServiceRoute {\n\n    /**\n     * \u8f6c\u53d1\u6a21\u5f0f\n     */\n    private RouteModeEnum mode;\n    /**\n     * \u5339\u914d\u503c\n     */\n    private String value;\n\n    /**\n     * \u8f6c\u53d1\u76ee\u6807\u5730\u5740\uff0c\u4f8b\u5982\uff1ahttp://192.179.0.1:8999\n     */\n    private String uri;\n\n    /**\n     * \u53d1\u9001\u8bf7\u6c42\u5934\n     */\n    private Map<String,String> headers;\n    //getter and setter\n}\n")),(0,a.kt)("p",null,"\u800c",(0,a.kt)("inlineCode",{parentName:"p"},"ServiceRoute"),"\u662f\u6700\u7ec8\u4ea4\u7ed9\u5f00\u53d1\u8005\u914d\u7f6e\u7684\u4fe1\u606f\uff0c\u8f6c\u53d1\u8bf7\u6c42\u65b9\u5f0f\uff0c\u5224\u65ad\u903b\u8f91\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"/**\n* \u6821\u9a8c\u5f53\u524d\u8def\u7531\u89c4\u5219\u662f\u5426\u7b26\u5408\n* @param serviceRoute \u8def\u7531\u5b9e\u4f8b\n* @param servletRequest \u8bf7\u6c42\u5bf9\u8c61\n* @return \u662f\u5426\u7b26\u5408\u89c4\u5219\n*/\nprotected boolean checkRoute(ServiceRoute serviceRoute,HttpServletRequest servletRequest){\n    boolean flag=false;\n    if (serviceRoute!=null){\n        switch (serviceRoute.getMode()){\n            //\u57fa\u4e8e\u8bf7\u6c42\u5934\n            case ROUTE_MODE_HEADER:\n                String value=servletRequest.getHeader(ROUTE_MODE_HEADER_NAME);\n                flag=StrUtil.equalsIgnoreCase(value,serviceRoute.getValue());\n                break;\n            //\u57fa\u4e8eURI\u7684\u524d\u7f00\u5339\u914d\n            case ROUTE_MODE_PREFIX:\n                flag=servletRequest.getRequestURI().startsWith(serviceRoute.getValue());\n                break;\n            //\u57fa\u4e8eURI\u7684\u540e\u7f00\u5339\u914d\n            case ROUTE_MODE_SUFFIX:\n                flag=servletRequest.getRequestURI().endsWith(serviceRoute.getValue());\n                break;\n\n        }\n    }\n    return flag;\n}\n")),(0,a.kt)("p",null,"\u9488\u5bf9\u6743\u9650\u7684\u8bbe\u8ba1\uff0c\u5728",(0,a.kt)("inlineCode",{parentName:"p"},"ServletGatewayRouteProxyFilter"),"\u4e2d\uff0c\u63d0\u4f9b\u4e86",(0,a.kt)("inlineCode",{parentName:"p"},"ServletGatewayAuthentication"),"\u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u8bbe\u8ba1\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"public interface ServletGatewayAuthentication {\n\n    /**\n     * \u6743\u9650\u6821\u9a8c\n     * @param request \u8bf7\u6c42request\u5bf9\u8c61\n     * @param response \u54cd\u5e94\u5bf9\u8c61\n     * @return \u662f\u5426\u6743\u9650\u6821\u9a8c\u901a\u8fc7\n     */\n    boolean auth(ServletRequest request, ServletResponse response);\n\n    /**\n     * \u6743\u9650\u6821\u9a8c\u5931\u8d25\u540e\u7684\u5904\u7406\u903b\u8f91\n     * @param request \u8bf7\u6c42\u5bf9\u8c61\n     * @param response \u54cd\u5e94\u5bf9\u8c61\n     */\n    void failedHandle(ServletRequest request, ServletResponse response);\n\n    /**\n     * \u662f\u5426\u9700\u8981\u9274\u6743\uff0c\u9ed8\u8ba4true\n     * @return \u662f\u5426\u9700\u8981\u9274\u6743\n     */\n    default boolean required(){return true;}\n}\n")),(0,a.kt)("p",null,"\u4e3b\u8981\u5305\u542b\u4e09\u4e2a\u63a5\u53e3\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"auth"),":\u6743\u9650\u9a8c\u8bc1\uff0c\u8fd4\u56de\u5e03\u5c14\u503c\uff0c\u8be5\u63a5\u53e3\u65b9\u6cd5\u4e3b\u8981\u662f\u517c\u5bb9\u7cfb\u7edf\u4e2d\u7684\u6743\u9650\uff0c\u5bf9\u4e8e\u5f53\u524d\u7684\u8bf7\u6c42\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u505a\u51fa\u6743\u9650\u5224\u65ad\uff0c\u4ea4\u7531\u5f00\u53d1\u8005\u5b9e\u73b0"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"failedHandle"),":\u5982\u679c\u6743\u9650\u9a8c\u8bc1\u5931\u8d25\uff0c\u6700\u7ec8\u54cd\u5e94\u4fe1\u606f\u7ed9\u524d\u7aef\uff0c\u5f00\u53d1\u8005\u5b9e\u73b0"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"required"),":\u662f\u5426\u9700\u8981\u9274\u6743\u7684\u6807\u5fd7\uff0c\u9ed8\u8ba4\u662ftrue\uff0c\u4ee3\u8868\u9700\u8981\u9274\u6743")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6700\u540e"),"\u518d\u6765\u770b\u4ee3\u7406\u8bf7\u6c42\u7684\u6267\u884c\u903b\u8f91(",(0,a.kt)("inlineCode",{parentName:"p"},"RouteDispatcher.java#execute()"),"\u65b9\u6cd5)\uff0c\u90e8\u5206\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'public void execute(HttpServletRequest request, HttpServletResponse response,ServiceRoute serviceRoute){\n    try{\n        //\u6784\u5efa\u8bf7\u6c42\u5bf9\u8c61\n        RouteRequestContext routeContext=new RouteRequestContext();\n        //\u8bf7\u6c42\u5bf9\u8c61\u8d4b\u503c\n        this.buildContext(routeContext,request,serviceRoute);\n        //\u53d1\u9001\u8bf7\u6c42\n        RouteResponse routeResponse=routeExecutor.executor(routeContext);\n        //\u54cd\u5e94\u7ed3\u679c\n        writeResponseHeader(routeResponse,response);\n        writeBody(routeResponse,response);\n    }catch (Exception e){\n        logger.error("has Error:{}",e.getMessage());\n        logger.error(e.getMessage(),e);\n        //write Default\n        writeDefault(request,response,e.getMessage());\n    }\n}\n')),(0,a.kt)("p",null,"\u9488\u5bf9\u8bf7\u6c42\u4e0a\u4e0b\u6587\u7684\u8d4b\u503c\uff0c\u4e3b\u8981\u662f\u63a5\u6536\u5f53\u524d\u8bf7\u6c42\u7684\u8bf7\u6c42\u53c2\u6570\u4ee5\u53ca\u8bf7\u6c42\u5934\uff0c\u5e76\u4e14\u6839\u636e",(0,a.kt)("inlineCode",{parentName:"p"},"ServiceRoute"),"\u8def\u7531\u57fa\u7840\u4fe1\u606f\uff0c\u8fdb\u884c\u57fa\u7840\u8d4b\u503c\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u6784\u5efa\u8def\u7531\u7684\u8bf7\u6c42\u4e0a\u4e0b\u6587\n * @param routeRequestContext \u8bf7\u6c42\u4e0a\u4e0b\u6587\u5bf9\u8c61\n * @param request \u8bf7\u6c42\n * @param serviceRoute \u8def\u7531\u5b9e\u4f8b\n * @throws IOException IO\u5f02\u5e38\n */\nprotected void buildContext(RouteRequestContext routeRequestContext,HttpServletRequest request,ServiceRoute serviceRoute) throws IOException {\n    //String uri="http://knife4j.xiaominfo.com";\n    String uri=serviceRoute.getUri();\n    if (StrUtil.isBlank(uri)){\n        throw new RuntimeException("Uri is Empty");\n    }\n    String host=URI.create(uri).getHost();\n    String fromUri=request.getRequestURI();\n    StringBuilder requestUrlBuilder=new StringBuilder();\n    requestUrlBuilder.append(uri);\n    //\u5224\u65ad\u5f53\u524d\u805a\u5408\u9879\u76ee\u7684contextPath\n    if (StrUtil.isNotBlank(this.rootPath)&&!StrUtil.equals(this.rootPath,ROUTE_BASE_PATH)){\n        fromUri=fromUri.replaceFirst(this.rootPath,"");\n    }\n    if (serviceRoute.getMode()== RouteModeEnum.ROUTE_MODE_PREFIX){\n        //\u524d\u7f00\u8f6c\u53d1\uff0c\u66ff\u6362\n        fromUri=fromUri.replaceFirst(serviceRoute.getValue(),"/");\n    }\n    if (!StrUtil.startWith(fromUri,"/")){\n        requestUrlBuilder.append("/");\n    }\n    requestUrlBuilder.append(fromUri);\n    //String requestUrl=uri+fromUri;\n    String requestUrl=requestUrlBuilder.toString();\n    logger.info("\u76ee\u6807\u8bf7\u6c42Url:{},\u8bf7\u6c42\u7c7b\u578b:{},Host:{}",requestUrl,request.getMethod(),host);\n    routeRequestContext.setOriginalUri(fromUri);\n    routeRequestContext.setUrl(requestUrl);\n    routeRequestContext.setMethod(request.getMethod());\n    Enumeration<String> enumeration=request.getHeaderNames();\n    while (enumeration.hasMoreElements()){\n        String key=enumeration.nextElement();\n        String value=request.getHeader(key);\n        if (!ignoreHeaders.contains(key.toLowerCase())){\n            routeRequestContext.addHeader(key,value);\n        }\n    }\n    //\u662f\u5426\u6709\u9ed8\u8ba4Header\u9700\u8981\u53d1\u9001\n    if (CollectionUtil.isNotEmpty(serviceRoute.getHeaders())){\n        for (Map.Entry<String,String> entry:serviceRoute.getHeaders().entrySet()){\n            routeRequestContext.addHeader(entry.getKey(),entry.getValue());\n        }\n    }\n    routeRequestContext.addHeader("Host",host);\n    Enumeration<String> params=request.getParameterNames();\n    while (params.hasMoreElements()){\n        String name=params.nextElement();\n        String value=request.getParameter(name);\n        //logger.info("param-name:{},value:{}",name,value);\n        routeRequestContext.addParam(name,value);\n    }\n    routeRequestContext.setRequestContent(request.getInputStream());\n}\n')),(0,a.kt)("h2",{id:"\u4f7f\u7528\u6307\u5357"},"\u4f7f\u7528\u6307\u5357"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"servlet-gateway-spring-boot-starter"),"\u7ec4\u4ef6\u662f\u4e00\u7ec4\u57fa\u4e8eServlet\u4f53\u7cfb\u7684\u4e1a\u52a1\u8f6c\u53d1HTTP\u7ec4\u4ef6,\u4e3b\u8981\u76ee\u7684\u662f\u5728\u73b0\u6709Spring Boot \u6846\u67b6\u7684\u57fa\u7840\u4e0a\uff0c\u6dfb\u52a0\u57fa\u4e8eFilter\u8fc7\u6ee4\u5668\u7684\u8f6c\u53d1\u80fd\u529b,\u4e30\u5bcc\u6846\u67b6\u7684\u4e1a\u52a1\u80fd\u529b\u3002"),(0,a.kt)("p",null,"\u76ee\u524d\u652f\u6301\u4e09\u79cd\u6a21\u5f0f\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ROUTE_MODE_HEADER"),":\u57fa\u4e8e\u8bf7\u6c42\u5934\u7684\u8f6c\u53d1"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ROUTE_MODE_PREFIX"),":\u57fa\u4e8e\u8bf7\u6c42Uri\u7684\u8bf7\u6c42\u524d\u7f00\u5339\u914d\u8f6c\u53d1"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ROUTE_MODE_SUFFIX"),":\u57fa\u4e8e\u8bf7\u6c42URI\u7684\u540e\u7f00\u5339\u914d\u8f6c\u53d1\u89c4\u5219")),(0,a.kt)("p",null,"\u4f7f\u7528\u65b9\u6cd5\uff0c\u5728Spring Boot\u7684\u6846\u67b6\u4e2d\uff0cpom.xml\u4e2d\u5f15\u5165\u5f53\u524d\u7ec4\u4ef6\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>com.github.xiaoymin</groupId>\n    <artifactId>servlet-gateway-spring-boot-starter</artifactId>\n    <version>1.0</version>\n</dependency>\n")),(0,a.kt)("p",null,"\u5728Spring Boot\u6846\u67b6\u7684",(0,a.kt)("inlineCode",{parentName:"p"},"application.yml"),"\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"server:\n  servlet:\n    gateway:\n      enable: true\n       cloud:\n         enable: true\n         # Routes\u8282\u70b9\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\n         routes:\n           - mode: ROUTE_MODE_PREFIX\n             # \u5c06\u6240\u6709\u4ee5/abb\u5f00\u5934\u7684\u8bf7\u6c42\u63a5\u53e3\u5168\u90e8\u8f6c\u53d1\u5230uri\u4e2d\u7684\u76ee\u6807\u670d\u52a1\n             value: /abb/\n             uri: http://knife4j.xiaominfo.com\n             # \u914d\u7f6e\u53d1\u9001\u9ed8\u8ba4\u8bf7\u6c42\u5934(\u53ef\u9009\u914d\u7f6e)\n             headers:\n               code: TESS\n")),(0,a.kt)("p",null,"\u9488\u5bf9\u4ee3\u7406\u8bf7\u6c42\u9274\u6743\u529f\u80fd,\u8be5\u7ec4\u4ef6\u63d0\u4f9b\u4e86",(0,a.kt)("inlineCode",{parentName:"p"},"ServletGatewayAuthentication"),"\u63a5\u53e3,\u5bf9\u4e8e\u63a5\u5165\u8be5\u7ec4\u4ef6\u7684\u9879\u76ee\u9700\u8981\u5b9e\u73b0\u8be5\u63a5\u53e3\uff0c\u5e76\u4e14\u6ce8\u5165\u5230 Spring \u7684\u5bb9\u5668\u4e2d"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"public interface ServletGatewayAuthentication {\n\n    /**\n     * \u6743\u9650\u6821\u9a8c\n     * @param request \u8bf7\u6c42request\u5bf9\u8c61\n     * @param response \u54cd\u5e94\u5bf9\u8c61\n     * @return \u662f\u5426\u6743\u9650\u6821\u9a8c\u901a\u8fc7\n     */\n    boolean auth(ServletRequest request, ServletResponse response);\n\n    /**\n     * \u6743\u9650\u6821\u9a8c\u5931\u8d25\u540e\u7684\u5904\u7406\u903b\u8f91\n     * @param request \u8bf7\u6c42\u5bf9\u8c61\n     * @param response \u54cd\u5e94\u5bf9\u8c61\n     */\n    void failedHandle(ServletRequest request, ServletResponse response);\n\n    /**\n     * \u662f\u5426\u9700\u8981\u9274\u6743\uff0c\u9ed8\u8ba4true\n     * @return \u662f\u5426\u9700\u8981\u9274\u6743\n     */\n    default boolean required(){return true;}\n}\n")),(0,a.kt)("p",null,"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u9879\u76ee\u4e2d\u901a\u8fc7Shiro\u63a7\u5236\u6743\u9650\u7684\u4f8b\u5b50\uff0c\u5bf9\u4e8e\u4ee3\u7406\u7684\u8bf7\u6c42\uff0c\u9700\u8981\u9a8c\u8bc1\u5f53\u524d\u7684\u8bf7\u6c42\u662f\u5426\u5df2\u7ecf\u767b\u5f55\u8fc7"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'public class AideShiroAuthentication implements ServletGatewayAuthentication {\n\n    private final OtsWebSessionManager otsWebSessionManager;\n    private final RedisTemplate redisTemplate;\n\n    Logger logger= LoggerFactory.getLogger(AideShiroAuthentication.class);\n\n    public AideShiroAuthentication(OtsWebSessionManager otsWebSessionManager, RedisTemplate redisTemplate) {\n        this.otsWebSessionManager = otsWebSessionManager;\n        this.redisTemplate = redisTemplate;\n    }\n\n\n    @Override\n    public boolean auth(ServletRequest request, ServletResponse response) {\n        Serializable sessionId = otsWebSessionManager.getShiroSessionId(request, response);\n        if (sessionId!=null){\n            Object object= redisTemplate.opsForValue().get(MyRedisSessionDao.PREFIX + sessionId.toString());\n            if (object!=null){\n                Session session = (Session)object;\n                return session!=null&&session.getId()!=null;\n            }\n        }\n        return false;\n    }\n\n    @Override\n    public void failedHandle(ServletRequest request, ServletResponse response) {\n        logger.info("\u6743\u9650\u6821\u9a8c\u5931\u8d25");\n        response.setCharacterEncoding("UTF-8");\n        response.setContentType("application/json; charset=utf-8");\n        RestResult<String> result = new RestResult<>();\n        result.setErrCode(BusinessErrorCode.NO_CURRENT_LOGIN_USER.getCode());\n        result.setData(BusinessErrorCode.NO_CURRENT_LOGIN_USER.getMessage());\n\n        try (PrintWriter out = response.getWriter()) {\n            out.append(JSON.toJSONString(result));\n        } catch (IOException e2) {\n            return;\n        }\n    }\n}\n')),(0,a.kt)("p",null,"\u901a\u8fc7\u81ea\u5b9a\u4e49\u6743\u9650\u63a5\u53e3\u540e\uff0c\u9700\u8981\u6ce8\u5165\u5230Spring\u7684\u5bb9\u5668\u4e2d(",(0,a.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a\u9700\u8981\u6dfb\u52a0",(0,a.kt)("inlineCode",{parentName:"p"},"@Primary"),"\u6ce8\u89e3)\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class AuthConfig {\n\n    @Bean\n    @Primary\n    public AideShiroAuthentication aideServletGatewayAuthentication(@Autowired OtsWebSessionManager otsWebSessionManager,@Autowired RedisTemplate redisTemplate){\n        return new AideShiroAuthentication(otsWebSessionManager,redisTemplate);\n    }\n}\n\n")))}c.isMDXComponent=!0},79737:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/servlet-gateway-51b8d46ba16697353f24c10897859c45.png"},61255:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/servlet-gateway2-6d1febf271a3b1b84b292179a0cbdccb.png"}}]);