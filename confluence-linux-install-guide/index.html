<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.40.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>confluence 安装指南(Linux) &middot; 八一菜刀</title>

  
  <link type="text/css" rel="stylesheet" href="https://xiaoymin.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://xiaoymin.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://xiaoymin.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://xiaoymin.github.io/css/hyde.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://xiaoymin.github.io/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://xiaoymin.github.io/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="八一菜刀" />

  
</head>

  <body class=" ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://xiaoymin.github.io/"><h1>八一菜刀</h1></a>
      <p class="lead">
       顺着生命的河流一起流淌,体会身边的每份感动和感悟. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="https://xiaoymin.github.io/">主页</a> </li>
      <li><a href="https://xiaoymin.github.io/blogs/"> 博客列表 </a></li><li><a href="https://xiaoymin.github.io/opensource/"> 开源软件 </a></li><li><a href="https://xiaoymin.github.io/softnews/"> 软件资讯 </a></li><li><a href="https://xiaoymin.github.io/about/"> 关于作者 </a></li>
    </ul>

    <p>&copy; 2018. All rights reserved. </p>
  </div>
</div>

    <div class="content container">
    <div class="post">
  <h1>confluence 安装指南(Linux)ddd</h1>
  <span class="post-date">Fri, Sep 1, 2017</span>
  

<h1 id="环境说明">环境说明</h1>

<p>1.服务器为centos，windos端需要一个ftp工具，把需要的东西拿到Linux下。
2.安装JDK1.8</p>

<h1 id="需要的文件">需要的文件</h1>

<ul>
<li>confluence的安装包
官网下载地址：<a href="https://www.atlassian.com/software/confluence/download" title="https://www.atlassian.com/software/confluence/download">https://www.atlassian.com/software/confluence/download</a>
本次下载的版本是：<strong><em>atlassian-confluence-6.3.2-x64.bin</em></strong></li>
<li>MySQL连接驱动程序
这个下载渠道很多，可以通过maven仓库去下载
下载地址：<a href="http://central.maven.org/maven2/mysql/mysql-connector-java/6.0.6/mysql-connector-java-6.0.6.jar" title="mysql-connector-java-6.0.6.jar">mysql-connector-java-6.0.6.jar</a></li>
</ul>

<h1 id="安装">安装</h1>

<h2 id="安装-jdk-1-8">安装 JDK 1.8</h2>

<p>Linux jdk的安装这里不再说明</p>

<h2 id="安装mysql">安装mysql</h2>

<ul>
<li>下载</li>
</ul>

<p>下载地址：<a href="http://dev.mysql.com/downloads/mysql/5.6.html#downloads">http://dev.mysql.com/downloads/mysql/5.6.html#downloads</a>
下载版本：我这里选择的5.6.33，通用版，linux下64位
直接下载：<code>wget  http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.33-linux-glibc2.5-x86_64.tar.gz</code></p>

<ul>
<li>解压</li>
</ul>

<pre><code class="language-shell">#解压
tar -zxvf mysql-5.6.33-linux-glibc2.5-x86_64.tar.gz
#复制解压后的mysql目录
cp -r mysql-5.6.33-linux-glibc2.5-x86_64 /usr/local/mysql
</code></pre>

<ul>
<li>添加用户组和用户</li>
</ul>

<pre><code class="language-shell">#添加用户组
groupadd mysql
#添加用户mysql 到用户组mysql
useradd -g mysql mysql
</code></pre>

<ul>
<li>安装</li>
</ul>

<pre><code class="language-shell">#切换到mysql主目录
cd /usr/local/mysql/
#创建mysql 数据文件夹
mkdir ./data/mysql
#授权
chown -R mysql:mysql ./
./scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql/data/mysql
cp support-files/mysql.server /etc/init.d/mysqld
chmod 755 /etc/init.d/mysqld
cp support-files/my-default.cnf /etc/my.cnf
#修改启动脚本
vi /etc/init.d/mysqld
 
#修改项：
basedir=/usr/local/mysql/
datadir=/usr/local/mysql/data/mysql
 
#启动服务
service mysqld start
 
#测试连接
./mysql/bin/mysql -uroot
 
#加入环境变量，编辑 /etc/profile，这样可以在任何地方用mysql命令了
export PATH=$PATH:/usr/local/mysql//bin&lt;br&gt;source /etc/profile
 
 
#启动mysql
service mysqld start
#关闭mysql
service mysqld stop
#查看运行状态
service mysqld status

</code></pre>

<ul>
<li>加入环境变量</li>
</ul>

<pre><code class="language-shell">vim /etc/profile
export MYSQL_HOME=/usr/local/mysql
export PATH=$MYSQL_HOME/bin:$PATH
#执行profile
source /etc/profile
</code></pre>

<ul>
<li>修改用户等选项</li>
</ul>

<pre><code class="language-shell">#登录
mysql -u root
use mysql;
select 'host' from user where user='root'; 
update user set host = '%' where user ='root';
#修改密码
update user set password=password('123456') where user='root';
flush privileges; 
</code></pre>

<h2 id="创建数据库">创建数据库</h2>

<p>两种方式，通过命令行创建、或者通过navicat 等连接工具创建，我是通过navicat工具创建的，也验证mysql连接可用</p>

<ul>
<li>创建数据库名：confluence</li>
</ul>

<p>#安装confluence5.8.10</p>

<ul>
<li>修改增加可执行权限</li>
</ul>

<pre><code class="language-shell">mv atlassian-confluence-6.3.2-x64.bin confluence.bin
#增加可执行权限
chown u+x confluence.bin
</code></pre>

<ul>
<li>安装</li>
</ul>

<pre><code class="language-shell">./confluence.bin
#根据提示操作安装

# 注意：在安装的过程中，如果你的默认目录被占用，端口8090被占用，会需要你自己设置端口号，这里安装是安装在/opt下，数据存放在/var目录下，用户目录在/home下，关于端口被占用的情况，一般是之前安装不成功，被无效的confluence用户占用了。可以使用lsof -i:8090查看是哪个进程占用了该端口，然后kill掉就OK了。如果不得不使用别的端口，记得在防火墙中开启该端口：iptables -I INPUT -p tcp -m state —state NEW -m tcp —dport xxxx -j ACCEPT
</code></pre>

<ul>
<li>访问</li>
</ul>

<p>浏览器访问：<a href="http://ip:8090/">http://ip:8090/</a>
回车后，进入安装界面，选择<code>install production</code>,然后直接跳过<code>add ones</code>，在出现serverID的时候，要保存复制</p>

<ul>
<li>获取License Key</li>
</ul>

<p>1、访问网址：<a href="http://id.atlassian.com">http://id.atlassian.com</a>
注册一个账号，也可以通过Google的Gmail账号登录（需要翻墙）</p>

<p>2、访问网址：<a href="https://my.atlassian.com/" title="https://my.atlassian.com/">https://my.atlassian.com/</a>
登录我的页面，点击页面上的<code>New Evaluation License</code> 链接，填入刚才安装界面的<code>serverID</code>，新生成一个License Key</p>

<p>3、上面获取的License Key 只有一个月免费</p>

<ul>
<li>配置数据库</li>
</ul>

<p>1.选择mysql，点击external database
2.选择上面的JDBC
3.在出现的界面上url的最后加上解决中文乱码的&amp;useUnicode=true&amp;characterEncoding=utf8
4.输入用户名和密码，这里的数据库账户密码是之前创建的username和user code
5.点击next如果出现已经存在xxxx的错误是因为之前安装过，直接overwrite就OK。</p>

<h1 id="关于破解confluence">关于破解confluence</h1>

<p>a.停止Confluence服务器
/opt/atlassian/confluence/bin/stop-confluence.sh
b. 将数据库连接程序 mysql-connector-java-5.1.32-bin.jar 和汉化包：Confluence-5.8.10-language-pack-zh_CN.jar放在 atlassian\confluence\confluence\WEB-INF\lib 目录
c. 将 atlassian\confluence\confluence\WEB-INF\lib\atlassian-extras-decoder-v2-3.2.jar 拷贝到Windows上，重命名为atlassian-extras-2.4.jar</p>

<p>d. 执行confluence_keygen.jar，输入一些列账户名称邮箱这些信息，输入serverID,点击Patch，选择 atlassian-extras-2.4.jar，点击gen
e. 这时候就生成了需要的秘钥，复制下来保存。
f.将atlassian-extras-2.4.jar重命名为原来的atlassian-extras-decoder-v2-3.2.jar，放回linux下的原位。
f. 重新启动confluence
/opt/atlassian/confluence/bin/start-confluence.sh
g. 刷新浏览器，输入密钥，进入下一步</p>

<p>#恢复数据
这里等待三分钟初始化结束后，如果想要新的界面，就点击empty site，如果要恢复，就选择最下面的导入backup文件，直接从windows下导入，导入结束后会自动import，当到100%的时候，就可以start up啦。</p>

<p>说明：中间可能会有一些稀奇古怪的问题，可以将报错信息google，一般会找到解决办法。实在不行，建议全部卸载重来一遍。</p>

<p>ps -ef|grep java 看看进程，可能是启动用户有问题
kill 掉之前起来的
/opt/atlassian/confluence/bin/startup.sh 用这个启动
tail -f /var/atlassian/application-data/confluence/logs/atlassian-confluence.log看下日志</p>

</div>


    </div>

    
  </body>
</html>