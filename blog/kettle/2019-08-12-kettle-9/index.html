<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-blog docs-doc-id-kettle/2019-08-12-kettle-9">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Kettle实战100篇 第9篇 Mysql数据库数据导出到Excel | 八一菜刀</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.xiaominfo.com/blog/kettle/2019-08-12-kettle-9"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-blog-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-blog-current"><meta data-rh="true" property="og:title" content="Kettle实战100篇 第9篇 Mysql数据库数据导出到Excel | 八一菜刀"><meta data-rh="true" name="description" content="Kettle实战100篇 第9篇 Mysql数据库数据导出到Excel"><meta data-rh="true" property="og:description" content="Kettle实战100篇 第9篇 Mysql数据库数据导出到Excel"><meta data-rh="true" name="keywords" content="Kettle实战,Kettle in Action,Kettle,Kettle JSON使用"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.xiaominfo.com/blog/kettle/2019-08-12-kettle-9"><link data-rh="true" rel="alternate" href="https://www.xiaominfo.com/blog/kettle/2019-08-12-kettle-9" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://www.xiaominfo.com/blog/kettle/2019-08-12-kettle-9" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EL1II9W21O-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-MHMEL0F832","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MHMEL0F832"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MHMEL0F832",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="八一菜刀" href="/opensearch.xml">





<script async defer="defer" data-website-id="23232" src="https://www.baidu.com"></script>
<script src="/js/baidu.js"></script>
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1589206801610969" async crossorigin="anonymous"></script><link rel="stylesheet" href="/assets/css/styles.31f948a3.css">
<link rel="preload" href="/assets/js/runtime~main.1ba6c6ba.js" as="script">
<link rel="preload" href="/assets/js/main.2fcd73bd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">🔪 八一菜刀</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">🎄 Blog</a><a class="navbar__item navbar__link" href="/opensource">🎄 开源</a><a class="navbar__item navbar__link" href="/chatgpt">🤖 ChatGPT</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">👨‍💻 MidJourney</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/getting-started">基础入门</a></li></ul></div><a class="navbar__item navbar__link" href="/langchain">🚴🏻‍♀️ langchain</a><a class="navbar__item navbar__link" href="/about">🚴🏻‍♀️ 关于</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><b>🔪 八一菜刀</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/blog/">个人博客</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/database/2016-10-12-mariadb-galera-startup">database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/javascript/js-closure">javascript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/blog/kettle/2019-08-08-kettle-1">kettle</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-08-kettle-1">Kettle实战100篇 第1篇 介绍与安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-08-kettle-2">Kettle实战100篇 第2篇 调用RESTful接口导入JSON结果入库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-08-kettle-3">Kettle实战100篇 第3篇 转换核心对象JSON input组件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-08-kettle-4">Kettle实战100篇 第4篇 转换核心对象REST client组件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-08-kettle-toc">Kettle 实战100篇 目录</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-09-kettle-5">Kettle实战100篇 第5篇 转换核心对象生成记录组件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-09-kettle-6">Kettle实战100篇 第6篇 转换核心对象字段选择组件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-10-kettle-7">Kettle实战100篇 第7篇 转换核心对象插入更新组件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-11-kettle-8">Kettle实战100篇 第8篇 Excel导入到Mysql数据库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-12-kettle-10">Kettle实战100篇 第10篇 JavaScript脚本中日志输出</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/blog/kettle/2019-08-12-kettle-9">Kettle实战100篇 第9篇 Mysql数据库数据导出到Excel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-13-kettle-11">Kettle实战100篇 第11篇 JavaScript表达式变量说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-13-kettle-12">Kettle实战100篇 第12篇 自定义开发Java工具类并在JavaScript脚本中运用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-13-kettle-13">Kettle实战100篇 第13篇 MySQL数据导出Excel数据乱码</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-14-kettle-14">Kettle实战100篇 第14篇 参数与变量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-14-kettle-15">Kettle实战100篇 第15篇 Mysql数据库表迁移</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-14-kettle-16">Kettle实战100篇 第16篇 JSON文件导入Mysql</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-14-kettle-17">Kettle实战100篇 第17篇 JSONPath组件介绍说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-15-kettle-18">Kettle实战100篇 第18篇 JavaScript脚本组件使用示例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-15-kettle-19">Kettle实战100篇 第19篇 转换核心对象Microsoft Excel输出组件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-15-kettle-20">Kettle实战100篇 第20篇 MySQL数据库导出到ElasticSearch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-16-kettle-21">Kettle实战100篇 第21篇 JavaScript内置函数说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-17-kettle-22">Kettle实战100篇 第22篇 资源库的使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-18-kettle-23">Kettle实战100篇 第23篇 命令行介绍使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-19-kettle-24">Kettle实战100篇 第24篇 日志报表输出</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-20-kettle-25">Kettle实战100篇 第25篇 作业核心对象设置变量组件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-21-kettle-26">Kettle实战100篇 第26篇 生产环境部署Pentaho</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-22-kettle-27">Kettle实战100篇 第27篇 系统级别任务调度调用转换&amp;作业</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blog/kettle/2019-08-23-kettle-28">Kettle实战100篇 第28篇 Carte作业服务详解</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/linux/2016-11-08-deploy-standard-linux">linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/mybatis/2019-05-10-mybatis-toc">mybatis</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/operate/2016-11-15-nginx-front-intruduce">operate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/redis/2020-11-29-redis-1">redis</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/springboot/2015-09-13-spring-mvc-jsonp-open">springboot</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/springfox/2019-05-20-springfox-0">springfox</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/blog/workflow/2018-01-11-workflow-choose">workflow</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Kettle实战100篇 第9篇 Mysql数据库数据导出到Excel</h1></header><p>我们在第8篇的时候已经介绍了将Excel的数据导入到Mysql数据库中,那么,本章我们将介绍将数据从数据库导出到Excel中.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="较少数据导出">较少数据导出<a href="#较少数据导出" class="hash-link" aria-label="较少数据导出的直接链接" title="较少数据导出的直接链接">​</a></h2><p>我们数据库表数据如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-1-4a3516ec6c58fe0c9f4ca2d131736ecd.png" width="875" height="613" class="img_ev3q"></p><p>数据库中总共存在36条数据,这是数据比较少的情况</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新建转换">新建转换<a href="#新建转换" class="hash-link" aria-label="新建转换的直接链接" title="新建转换的直接链接">​</a></h3><p>我们选择 文件 -&gt; 新建 -&gt;转换</p><p>建立导出Excel的转换,输入转换名称然后保存</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="表输入">表输入<a href="#表输入" class="hash-link" aria-label="表输入的直接链接" title="表输入的直接链接">​</a></h3><p>既然是从数据库表导出数据,所以我们的ETL的第一个步骤就是表输入</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-2-7fdcc1870f1a35c629f3c35635b297ff.png" width="472" height="345" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新建数据库连接">新建数据库连接<a href="#新建数据库连接" class="hash-link" aria-label="新建数据库连接的直接链接" title="新建数据库连接的直接链接">​</a></h4><p>在选择表输入组件时,我们首先需要创建我们的数据库连接</p><p>点击新建按钮,在弹出的数据库编辑框中填入数据库信息，如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-3-74d33a8daf84a5f714bc067ce9bac891.png" width="1290" height="610" class="img_ev3q"></p><p>在输入完成后,我们可以点击测试按钮对数据库连接进行测试,以查看数据库是否可用</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-4-2b0f3842ab841bb435af1c9287e4af6c.png" width="1290" height="610" class="img_ev3q"></p><p>信息无误后,点击确定</p><p>此时，我们可以输入我们的查询SQL语句对表进行查询以获取结果</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-5-77ac8c9c86247e74afdc391e67603537.png" width="659" height="439" class="img_ev3q"></p><p>点击预览按钮,弹出预览记录数量限制数量设置，即可以预览数据：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-6-7b6ba0542ad062509edabfec8fa1b925.png" width="1101" height="431" class="img_ev3q"></p><p>预览无误,说明我们的信息是正确的,我们的表输入最终属性配置信息如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-7-c519704a8ea42d1a2c78dbec7e168a27.png" width="659" height="439" class="img_ev3q"></p><p>因为我们总数只有36条记录,因此在记录数量限制这里不妨可以设置一个最大值,此处我设置的是40</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="microsoft-excel输出">Microsoft Excel输出<a href="#microsoft-excel输出" class="hash-link" aria-label="Microsoft Excel输出的直接链接" title="Microsoft Excel输出的直接链接">​</a></h3><p>因为我们最终是通过Excel输出,因此我们从转换的核心对象树的输出栏 选择<strong>Microsoft Excel输出</strong>组件</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-8-a78fbabdb3a1572c1b8d0717dcba195e.png" width="1190" height="304" class="img_ev3q"></p><p>设置输出组件的属性</p><p>因为比较简单,因此我们只需要设置导出的Excel文件名称即可,如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-9-478d6937065ff5c42c394df8790535fe.png" width="1015" height="728" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运行">运行<a href="#运行" class="hash-link" aria-label="运行的直接链接" title="运行的直接链接">​</a></h3><p>此时我们的ETL转换已创建完成,如下图：</p><p><img loading="lazy" src="data:image/png;base64,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" width="451" height="146" class="img_ev3q"></p><p>此时,我们点击Spoon界面上的运行按钮,执行该转换过程,导出Excel结果如下：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-11-c3784709a2470f45c3c41b7db316cbf6.png" width="1366" height="736" class="img_ev3q"></p><p>针对较少的数据,利用Kettle非常轻松的帮助我们导出了数据到Excel中.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="较多数据导出excel">较多数据导出Excel<a href="#较多数据导出excel" class="hash-link" aria-label="较多数据导出Excel的直接链接" title="较多数据导出Excel的直接链接">​</a></h2><p>我们在上个步骤中将数据库表中较少数据(36条)导出到了Excel中,这几乎没什么难度,那么如果我们的数据库表中数据比较多时,是否也能按这种方式导出呢？</p><p>答案肯定是否定的,因为如果我们一次查询数据较多的话,很可能导致内存溢出的异常或者Kettle直接就崩溃了.</p><p>此时我们可以使用分页技术,来将我们的数据按页码批量导出</p><p>我们数据库拥有fund表,此时,我们想通过Kettle将fund表的记录全部导出,我们应该怎么做呢？</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-12-f9d4f98d91f021a68a6c9fcc9a75b674.png" width="1033" height="565" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分页导出">分页导出<a href="#分页导出" class="hash-link" aria-label="分页导出的直接链接" title="分页导出的直接链接">​</a></h3><p>我们首先先按照分页来进行数据的导出</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新建转换-1">新建转换<a href="#新建转换-1" class="hash-link" aria-label="新建转换的直接链接" title="新建转换的直接链接">​</a></h4><p>文件 -&gt; 新建  -&gt; 转换</p><p>保存转换名为：分页导出数据</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="设置分页变量">设置分页变量<a href="#设置分页变量" class="hash-link" aria-label="设置分页变量的直接链接" title="设置分页变量的直接链接">​</a></h4><p>我们都知道Mysql中可以使用limit关键字来进行分页查询数据,因此第一步,我们需要通过生成记录组件定义两个变量,分别是：</p><ul><li>pageSize:每页查询数据大小</li><li>offset：数据库位移位置</li></ul><p><img loading="lazy" src="/assets/images/kiadbtoexcel-13-306a6faf68282d45d13e6f1fa112abd8.png" width="1196" height="583" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="表输入-1">表输入<a href="#表输入-1" class="hash-link" aria-label="表输入的直接链接" title="表输入的直接链接">​</a></h4><p>设置好变量后,我们可以拖入表输入组件,进行相关的属性设置</p><p>分别设置SQL查询语句,注意我们在SQL语句中使用了Mysql的limit分页,并且通过前面的变量来代替相关的值</p><p>如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-14-1dc73ac91b6ecb5eb5d977d2684905a6.png" width="659" height="439" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="microsoft-excel输出-1">Microsoft Excel输出<a href="#microsoft-excel输出-1" class="hash-link" aria-label="Microsoft Excel输出的直接链接" title="Microsoft Excel输出的直接链接">​</a></h4><p>最后,我们通过Excel输出组件配置导出到Excel</p><p>这里我们需要注意的是,扩展类型我们需要选择xlsx格式(因为97格式会有总记录的条数限制)</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-15-e74a8e7775539f1af8f8fa72453d2262.png" width="1015" height="728" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运行-1">运行<a href="#运行-1" class="hash-link" aria-label="运行的直接链接" title="运行的直接链接">​</a></h4><p>此时,我们的最终转换如下图：</p><p><img loading="lazy" src="data:image/png;base64,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" width="564" height="132" class="img_ev3q"></p><p>最终查看我们导出的数据如下：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-18-bce5506270b38de4e73c0ffcb1cc03b7.png" width="1366" height="736" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="全部导出">全部导出<a href="#全部导出" class="hash-link" aria-label="全部导出的直接链接" title="全部导出的直接链接">​</a></h3><p>上面我们使用了分页的方式将我们的数据按页码导到了Excel中,如果我们想把数据表中的全部数据都导入到Excel,应该如何做呢?</p><p>此时,我们可以把分页导出转换作为一个作业子项,我们在作业子项中设置分页条件,轮训总页码进行批量导出,核心点在于我们只需要设置offsetSize变量,然后轮训进行替换即可</p><p>我们需要两个计算页码的公式</p><p>根据记录总数计算总页码：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var </span><span class="token assign-left variable" style="color:#36acaa">totalPage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">totalRows+pageSize-1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> / pageSize</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>计算Mysql中的offset值</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var </span><span class="token assign-left variable" style="color:#36acaa">nowOffSize</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pageSize * page </span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="作业图">作业图<a href="#作业图" class="hash-link" aria-label="作业图的直接链接" title="作业图的直接链接">​</a></h4><p>我们先来梳理一下我们这个全部导出作业需要做的事情：</p><ul><li>首先需要查询目标表的总记录数,然后根据我们设置的每页查询大小计算出总页数</li><li>轮训分页导出记录到Excel 组件</li></ul><p>因此,我们起码需要一个作业和两个转换,才能帮助我们完成数据的全部导出任务</p><p>先来看我们已经完成的作业图,如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-22-e82eae5e30f2a009c5016bb1051abaa3.png" width="656" height="228" class="img_ev3q"></p><p>接下来我们逐步分析我们每个步骤的逻辑</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新建作业">新建作业<a href="#新建作业" class="hash-link" aria-label="新建作业的直接链接" title="新建作业的直接链接">​</a></h4><p>新建全部导出作业</p><p>选择  文件 -&gt; 新建 作业</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="设置变量">设置变量<a href="#设置变量" class="hash-link" aria-label="设置变量的直接链接" title="设置变量的直接链接">​</a></h4><p>我们在建立作业任务时,因为需要使用分页技术对数据进行查询,因此我们的分页导出数据中的转换SQL语句就不能使用常量,必须使用变量。因此我们的作业第一步是设置变量，如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-23-0cb8b6be3b16139c63062a7d59f9a259.png" width="658" height="568" class="img_ev3q"></p><p>我们主要定义了5个变量并赋予初始值,并且变量的方位都是在JVM中有效</p><ul><li>offsetSize:该值是我们在使用MySQL分页查询语句limit的offset位移值</li><li>pageSize:每页查询的数据大小,默认2000</li><li>totalPage:总页数,我们在这里实现定义好变量,后面方便我们使用它</li><li>currentPage:当前页码,默认值1</li><li>shellFirst:该变量是我们在查询MySQL数据后需要追加到Excel的其实行数值,A1代表从第一行开始写入数据,随着翻页查询,shellFirst的值变化规则是A(offsetSize+1)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取目标数据表总记录数">获取目标数据表总记录数<a href="#获取目标数据表总记录数" class="hash-link" aria-label="获取目标数据表总记录数的直接链接" title="获取目标数据表总记录数的直接链接">​</a></h4><p>第二步我们就需要新建一个转换,用来获取我们的目标表总记录条数,转换如下图：</p><p><img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWIAAACHCAYAAAAsolP/AAANQ0lEQVR4nO3da2xb5R3H8X+2UdquXAqlKwOalBQINGJF5SYYbTI6FCsaTFP2YgiBUCItG5X2YraivZqmTWJR+gat0oJwxN4UaWu1DUZwNi5OC+1KKaOwFDKg1CllZIUGeoEWuuGd/+Pb8fGxa8eXJ06+H2TS2MfnPImf88v/POc5dkPcIQAAa75kuwEAMNcRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABgGUEMAJYRxABg2VdsN6Be7XvnkDwW2SFvvTspkx9+XNVtLVtyvlxx2TK5c90aual1ZVW3hdqg/8CtIe6w3Yh6s+XpXfLcS/vk7sCtpoNrR68m3VF1h31i28tmWz+9p7Oq20N10X/gRRCX6JV/xeR3T2yTh0L3Wdn+g48+LquvbJTArautbB/lof/AD2PEJdLDSa1kbOlaf5NsfeZFa9tHeeg/8EMQl0jH9lZdfqm17euhrB5moj7Rf+CHk3UlOvHpKVm0cL7tZqBOFdN/Hn1iVB79y7aKbXP7Iz+v2LpQHQQxMAOtdCrXnq47ylpH7NCkDG75W4VahGoiiCtoc+QFOTh5pCLrOu+chfLjrm9XZF2oP4sWzJdrVjbZbgZqhDHiCtq9b7+89vZB+SIuZd0OHZ6S0T2v2/5xANQIFXGFtTYvlwfuubOsdWzbvVc2P7m9Qi3CTKdjwm5735yQySMfy5anRn2XL2TVlU1U0nWIIAYs0xNz69asksXnLTLfN17yNXM7fvKzktazc++4+UoQ1x+CGLOGVpY3tq60Oj1suh74QafMX1D+bJxdr70ph6eOmX9/dPxE2etDbRDEmDWOfnJSfvTgkCxftkQCt3xDbr+xVZZdWN3Lh2eab66+Su6/s838W6/i2z32tt0GoSgEcYX9+4MpM8Zbjjf2H6pQa+aWu9aukcdH98jByQ/l4T8+a25aHXdoKN/QyvxvzFgEcYUtnD9Pll+0OOu+t9+dlKljn8iNq5pzln9sZIfc3ZF9yevk4amqtnG2WnHJUrnuqibZ88Y76fv0Sja9/eb3fzWPaSjftrpF5p1F18fMQW+ssAvOXWR2eC89C+53/8jOV3Pu12UxPevWXJ0VxCmfn/6vvOgcputNK2OtkL91wyq59orl8uUv2Z/F+Z+pj2TphYvPvGABUx8fl8VfpeqvRwQxZpU7br7WVL8avPnoZcaPb9tjbhctPtc8R8eUdWzZltOnTjl/LUqbJeH1+enTFWoNao0grlNre35huwkzV0Pxi37w0TFzReTmp16oXnuK0NL49bLHsC9deoGZg5yalzx55GgFWoZaIIhnqHs7byv4+PYwb+TiJ7Jzr3nP3UI08HScWIcmrr/m8poOTVT7D6i+R0XqvYZ1bFx/H5j5COIKO/nZ5zljvFPHTsjR45/6jv36La/jl5xMmp6nd/3T9379fc6Fk3WLFpydnrL3fpU/ggmVMzt7o0XvHZ6SyI7sKkQPEU+cPGVC90zLa0Vz23UtVW/nbHTgvcNm7qwb09dQDwjiCtMgTU2oT9Fw0Ko3cEvux9NoSHuXx/RE/v6q/O+LL8xJt9tvWGUu6LB5Aq7W+NSz+kUQY9ZYMO8s+e3PuuvyEuctz+ySi5eUN31NT9St5WiqLhHEmDXq+cji++tvLnvo5M2D70tk56smkJVO00N9IIgtW3P1iqzv9dD62d1jZm4rUKqLl5xvPqU5Rd97AjMfQVxh5uSbZ8qQfmrH0ROf5iyrZ++9gTv68uvyq6E/mef0fLe9qm3F7KMhXM9HBnMVQVxh+gkdevPz5PP/SP9bQ9bvUFTP7muYh/8cTS+n82L1hN8ffv2T6jQagFUEcQU9FLyvIuu5t3Ot+ZoKY8x+OudXhxXKceTocTmHKXp1iSCeodxhrJXzogq8aThmru5fPlyR9dz/nXUVWQ9qiyAukV6RpW8oU+0rs1KX6Z63aKEZXyaIZwe//rP9ES5Xn+vsv/9fnbnismXy1ruTVd+OjgnrbcHZ88wlq0sXn2vun3QOYZeVeQgLe2rVf/Kh/8xMVMQl0stl9T2Eq33RQL4Tc8+/Ms4l0HWsVv0nH/rPzERFXKK72q43VYV+DE8tJ8zrtrY8vUuee2mf/PB7t9dsu6gs+g/8NMS5QH1a9P1rN4/sqNnOpCfs9O0N9WQMb15T/+g/cCOIAcAyhiYAwDKCGAAsI4gBwDKCGAAsI4gBwDKCGAAsI4gBwDKCGAAsI4jLMiqhhpDz/wJLhAIyNJFzpzQ0NEhDKN8zdb0+z0MNTOd3PyFDgTz9QF/r5Ovs7gsTQ4FEH/C5BdIb1/X6L1PSsoEhSf84E0MScH2v7QjkdlAJuZ+T9bsp3J6GM+wP8EcQF82vo7fLRue/9rwdf0L2j7VKc/ojxJIdebjTfPR5rKU/eydJa5OBeJ+MN9Gpa200pK/piPQ0FQqbVKDm/0OsAef9O9s2kHlNG7sjpg94b7Fwh+sZjdIdyV2m8LIxCXd0SDjmWjbSLeLTHm3/pp5W6etu9D5QQFCi6TZEne+832Na4ihDNO50ROf/fg8F9dJxz60j7uwjWfd1BINxZ3eKB/1WouvwfQDV4ASb8/p0+L8WiSXi4Y7M663L577GzmvqpKA+ZtbjfQ2d7/Xxgm1wPR4N5q7fu60srvVHgx3x1MPp9sTCzs8Yjse82/Ltr5lb4kfQ/l64PZJvf0BBVMSlSA0pnKEiNpVH24DoXuTs2E7fjCYrhohEPBVOZGBAIs7XgbbczU3sHxPZ2M8QRS04h+y9430y2OX8ytvzVcJN0jOSeoJTTW7tklg8VYVmKsNIoQrT6RcFH89ZvNiKONGmUH+LDCbXbyrwXr8jrkz7zbLar5NHafFUZdsRTv5siVumf1IRV0Vtc3+2KVARx5MVSThVEWVXE5kiybk/WaFk0+rL/XzUQrpy9H80UxEXrCCDzuvmqYjTy6eqVF1XgSpXK9czVp/Z/amoCj1ZEUfdy/r0z6xbun9SEVcLFXGx9CRHToWUZ4zYjCGOyvDGVmludq8kUT0kKpkCJ3jU6CbpkS5Z371BwmNUxbVUVEWsRzzpSjC7Io7HB2S9d6VmeV3Ofaf7OZ4qt7HbHCnFs27e7WRXrJlxZ3dFG5O+Zm9jRFaYZaMSDsckbspdPS+Rp/qOdEuyxvYs462IEz97W8VeibmDIC5Wzo6R6OxOZaEFRdahWTAakW7ZL2Ma0u0bdc+WhtCw80gitJsyx7d5OCHdv1GCfboDNEp3X6v0bBqt/s8IE2YmDNPDSd6bK2jSQ1Ua0Jk/yLmzEErbfmboInFyN3t9G2V4NPVv/WOemYkxGnIVCCM90pRsW/vwgdwNmba3S09PU7rNmef7zczwmzFRqBCZ9q9gTiKIp8NUx8PS6VQKbd2D0tKf6oDOfanxtFRwR4OJnXqgU7Ir4kKr73Wq4bBsaEve0UZVXCs628H8odQ/nkVMz+rQitJdqUbLHyXVQEzMcEhUoIPSK4FQSAKBTTIu2jSnDaYPNsl4n/NHP5nbmfFkzxiv3wmIrIo+Na7tmW2R9fN4qmHTr4OmIg4GvVVxpk0oDkFcIlM19G51+myLrDD36LSh5CFnsNP/sEx36kB/okI+U0WsJ416WiWaPhxMbmOwS7Yyna2KEtMTm5In4GLhYHYoxcJOTGlQFXforZWtX/4lONVl6JkCz+6QlhWZ7w6Mj4hTcEtfZIO0OMEXDo9Je6/IYJ6TvKW0J10FB4acY7gipI4C9OSeKS5EOp2vw975yigJQVys5BjxcKeOmfVJq+u+htCBxBzOzuHModlQssPq0IRWxOY57opYA9yzU2snb9oqXX47u1bYUXGCnDCuigknGPsy46GN3RtEel2VsAm+wpXecCjxerc2FyoHdY5yv7Rs0FHkMdmfk1zJcwu6imTo9bfEsoZEmnV8t2/cDD3kvSYoPTThf+HQgeQFJaY/J8eBm/3mT2v/Nb+fZF9Pza7ISvVktTyovzKGJqalcuf95pDUGW3f2Q4eUfesiWA8GEydOXedNU+c8nbWWcQZZ3P2nTPT1ZA9ZzczB9fImsXgecwzvzi5Mv8ZMlLcPGT3fN+sbXv6XDTdn/LNysltT755zO55x+7n5Z/3XHjWEIrHZ9YBgGUMTQCAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZQQxAFhGEAOAZf8HF8pydyz2Pd8AAAAASUVORK5CYII=" width="354" height="135" class="img_ev3q"></p><p>这个转换很简单,只有两个组件：表输入、复制记录到结果</p><p>表输入组件是我们编写从数据库查询目标表的统计SQL语句,如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-25-2251f702c42b50941fb3ce6fc69ea730.png" width="659" height="543" class="img_ev3q"></p><p>统计<code>fund</code>表的总记录SQL语句：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> fundCount </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> fund</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后将我们的结果复制到结果即可</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="javascript脚本-计算总页数">JavaScript脚本-计算总页数<a href="#javascript脚本-计算总页数" class="hash-link" aria-label="JavaScript脚本-计算总页数的直接链接" title="JavaScript脚本-计算总页数的直接链接">​</a></h4><p>我们得到了目标表的总记录数,接下来我们需要一段JavaScript脚本帮助我们计算得到总页数，脚本内容如下：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> preRows</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">previous_result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getRows</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">//获取上一个步骤的结果集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> subject</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;自定义日志输出&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> logFactory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">org</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">pentaho</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">di</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">core</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">logging</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">LogChannelFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> log</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> logFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">preRows</span><span class="token operator" style="color:#393A34">==</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> preRows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> countBySql</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">preRows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getInteger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fundCount&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//赋值变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> pageSize</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;pageSize&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">logMinimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;pageSize:&quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">pageSize</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">&quot;,countRecords:&quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">countBySql</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//计算总页码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> totalPage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xiaominfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">kettle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">PaginationUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">totalPage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">countBySql</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pageSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">logMinimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;totalPage:&quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">totalPage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//设置总页码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;totalPage&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">totalPage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里有几个组件需要说明一下：</p><ul><li>脚本中我们使用了Kettle的内置对象<code>previous_result</code>用以获取上一个步骤的记录行数,因为我们上一个步骤是获取总记录数的转换(记录行已经复制到结果),关于JavaScript脚本的内置对象，表达式介绍可以参考Kettle实战100篇 第11篇 JavaScript表达式变量说明</li><li>在脚本中我们使用了Kettle中的日志组件,日志组件可以在控制台输出关键信息,帮助我们快速定位问题，关于日志可以参考Kettle实战100篇 第10篇 JavaScript脚本中日志输出</li><li>最后一个是我们使用了自定义的Java类<code>PaginationUtils</code>,该类是我开发的工具集,方便在JavaScript脚本中使用快速计算的,totalPage方法就是一个根据总记录数以及pageSize来得到总页数的函数，关于自定义开发的功能,可以参考Kettle实战100篇 第12篇 自定义开发Java工具类并在JavaScript脚本中运用</li><li>我们得到总页码后,最后通过<code>parent_job</code>内置对象的<code>setVariable</code>方法再将我们得到的结果在重新赋值.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="检查字段的值">检查字段的值<a href="#检查字段的值" class="hash-link" aria-label="检查字段的值的直接链接" title="检查字段的值的直接链接">​</a></h4><p>初始化好我们的总页码后,接下来我们就需要设置轮训分页条件了，如下图</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-26-e414583dd8ab145c6ea67ed251392e1a.png" width="512" height="453" class="img_ev3q"></p><p>设置当前的页面小于等于总页码数,符合条件即进行分页Excel导出转换的操作,否则程序结束.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分页导出excel转换">分页导出Excel转换<a href="#分页导出excel转换" class="hash-link" aria-label="分页导出Excel转换的直接链接" title="分页导出Excel转换的直接链接">​</a></h4><p>在分页导出Excel转换中,区别于较少数据的转换,我们需要从父作业中获取变量，然后传递到子转换中的相关组件中使用变量,所以整个子转换如下图：</p><p><img loading="lazy" src="data:image/png;base64,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" width="656" height="156" class="img_ev3q"></p><p>第一步是获取变量,该操作和我们上面较少数据导出其实是大同小异,无非是把生成记录组件中定义的变量替换使用父作业中的变量 ，如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-28-dc74c237a48f8a167d06605193da8cad.png" width="781" height="313" class="img_ev3q"></p><p>定义子转换中的相关变量。</p><p>第二步是表输入组件,分页查询数据，如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-29-3b5515916bd4a4f76597c24212cc2a50.png" width="659" height="696" class="img_ev3q"></p><p>在表输入组件中,我们使用定义的变量代替SQL语句中的limit分页数值,然后勾选替换SQL语句里的变量选项已经使用懒惰算法选项，记录数量限制为0（即不限制）</p><p>最后我们选择Microsoft Excel 输出组件,把我们的结果输出到Excel中</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-30-4a5759d158f99e3d59806bd73f250915.png" width="1029" height="728" class="img_ev3q"></p><p>因为我们并非是一次全部导出,而是采取的分页,因此在设置好文件名及文件扩展后,需要选择如果文件已存在则使用现有文件输出</p><p>工作表选项卡中如果输出文件中已存在工作表也选择继续输出至已存在的工作表中</p><p>然后是内容选项卡：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-31-0b60f86e90f277c0e70b559aacdbf7ab.png" width="1029" height="728" class="img_ev3q"></p><p>此处需要设置楷书输出子单元格的变量,即我们父作业中定义的<code>shellFirst</code>变量，在Excel的Sheet表格中即代表从哪一行开始输出数据</p><p>然后勾选在表的末尾开始写(追加行)选项,最后点击确定保存</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="检查页码条件">检查页码条件<a href="#检查页码条件" class="hash-link" aria-label="检查页码条件的直接链接" title="检查页码条件的直接链接">​</a></h4><p>接下来我们需要检查赋值我们的页码，通过JavaScript脚本来实现,脚本内容如下：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> page</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;currentPage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> totalPage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;totalPage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> subject</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;自定义日志&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> log</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">org</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">pentaho</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">di</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">core</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">logging</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">LogChannel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token operator" style="color:#393A34">==</span><span class="token plain">totalPage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//设置offsetSize的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> pageSize</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;pageSize&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//在page++之前先计算offset的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//offset方法为page*pageSize</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> nowOffSize</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xiaominfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">kettle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">PaginationUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">offset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pageSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    page</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;currentPage&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> shellFirst</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;shellFirst&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//日志输出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">logMinimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;offset：&quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">nowOffSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;offsetSize&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">nowOffSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> shellNum</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nowOffSize</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> newShellFirst</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">shellFirst</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">shellNum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">logMinimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Shell单元格开始输出记录行:&quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">newShellFirst</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent_job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;shellFirst&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">newShellFirst</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该代码逻辑主要步骤：</p><ul><li>判断当前页码是否已经等于总页码,即如果是最后是总页码则程序返回false，不继续执行</li><li>如果当前页码小于总页码,首先计算下一个SQL语句翻页的offset的值(因为我在计算的时候并非是从0开始,因此这里的page++动作需要在后面执行),赋值下一个offset的值</li><li>当前页码+1，使用<code>parent_job</code>内置对象重新赋值当前页码变量</li><li>由offset值计算得到在输出Excel数据时从哪一行开始输出(不能计算错误,否则导出的 Excel数据不是缺失就是被覆盖错误),重新赋值<code>shellFirst</code>变量</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="执行">执行<a href="#执行" class="hash-link" aria-label="执行的直接链接" title="执行的直接链接">​</a></h4><p>整个作业过程完成,运行该作业,得到我们导出的该fund表的全部数据<code>24332</code>条</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-32-4edfbc08bbc748efbca79389fd37b676.png" width="1366" height="736" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="FAQ的直接链接" title="FAQ的直接链接">​</a></h2><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="表输入组件预览数据导出excel数据乱码">表输入组件预览数据、导出Excel数据乱码<a href="#表输入组件预览数据导出excel数据乱码" class="hash-link" aria-label="表输入组件预览数据、导出Excel数据乱码的直接链接" title="表输入组件预览数据、导出Excel数据乱码的直接链接">​</a></h4><p>该问题我在使用分页查询导出的时候碰到了乱码的情况,我的情况比较特殊,我通过浏览已经建立好的数据库连接的中的数据时并非乱码,而当我使用表输入组件中的预览数据时缺产生了乱码,因此我不得不设置我们的数据库连接参数</p><p>乱码主要分几种情况</p><p>一、查看我们的数据库的服务端字符集是否是UTF-8(常用字符集)</p><p>可以使用navicat连接到我们的数据库,然后使用命令行，输入查询语句进行查看，如下：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;%char%&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+-----------------------------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Variable_name            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Value</span><span class="token plain">                                         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+-----------------------------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_client     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8mb4                                       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8mb4                                       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_database   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8                                          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_filesystem </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">binary</span><span class="token plain">                                        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_results    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8mb4                                       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_server     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8                                          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_system     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8                                          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_sets_dir       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> D:\Users\xiaoymin\Bin\mariadb\</span><span class="token keyword" style="color:#00009f">share</span><span class="token plain">\charsets\ </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+-----------------------------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.08</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中<code>character_set_server</code>就是我们的数据库服务端编码</p><p>我们也可以使用SQL语句查询我们的表字段编码，如下：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show full columns from fund;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/kiadbtoexcel-21-a80cc15395f7c7a6c7966ce8e0522fd1.png" width="947" height="479" class="img_ev3q"></p><p>如果我们第一步检查是OK的,但是浏览数据依然是乱码,那么我们就需要修改Kettle中的配置参数</p><p>点击表输入组件的编辑按钮，对数据库信息进行编辑</p><p>1、选择高级选项卡,添加相关字符码</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-19-ff69aa1bdacf7aa5387d2a47e5ee3433.png" width="1366" height="610" class="img_ev3q"></p><p>2、高级选项卡中设置names值，网上的解决方案大多是使用utf8，但是我本机使用后发现还是乱码,因此我改成了gbk，这个大家自行根据自己的情况设定</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set names gbk;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如下图：</p><p><img loading="lazy" src="/assets/images/kiadbtoexcel-20-617b4f248c14dcea8df427128140e9f3.png" width="1366" height="610" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xiaoymin/blog-ai/blob/master/programmer/blog/kettle/2019-08-12-kettle-9.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>xiaoyumin</b> <!-- -->于 <b><time datetime="2023-06-11T10:11:43.000Z">2023年6月11日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/kettle/2019-08-12-kettle-10"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Kettle实战100篇 第10篇 JavaScript脚本中日志输出</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/kettle/2019-08-13-kettle-11"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Kettle实战100篇 第11篇 JavaScript表达式变量说明</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#较少数据导出" class="table-of-contents__link toc-highlight">较少数据导出</a><ul><li><a href="#新建转换" class="table-of-contents__link toc-highlight">新建转换</a></li><li><a href="#表输入" class="table-of-contents__link toc-highlight">表输入</a></li><li><a href="#microsoft-excel输出" class="table-of-contents__link toc-highlight">Microsoft Excel输出</a></li><li><a href="#运行" class="table-of-contents__link toc-highlight">运行</a></li></ul></li><li><a href="#较多数据导出excel" class="table-of-contents__link toc-highlight">较多数据导出Excel</a><ul><li><a href="#分页导出" class="table-of-contents__link toc-highlight">分页导出</a></li><li><a href="#全部导出" class="table-of-contents__link toc-highlight">全部导出</a></li></ul></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 八一菜刀, Inc. Built with <a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer">Docusaurus</a>.<br> 浙ICP备18027673号</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1ba6c6ba.js"></script>
<script src="/assets/js/main.2fcd73bd.js"></script>
</body>
</html>