<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>confluence安装指南</title>
    <meta name="keywords" content="xiaoymin的博客,confluence,confluence安装指南" />
    <meta name="description" itemprop="description" content="confluence安装指南">
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" id="page_favionc" />
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/lib/layui/css/layui.css"  media="all" />
    <script src="/lib/layui/layui.js" charset="utf-8"></script>
    <link rel="stylesheet" href="/css/xiaoymin.css"  media="all" />
    <link rel="stylesheet" href="/css/markdown.css"  media="all" />
    <link rel="stylesheet" href="/lib/ztree_toc/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <script type="text/javascript" src="/lib/ztree_toc/js/jquery.ztree.core-3.5.min.js"></script>
    <script type="text/javascript" src="/lib/ztree_toc/ztree_toc.js"></script>
    <style type="text/css">
        body{
            overflow: hidden;
        }
    </style>
</head>
<body>
<div class="layui-row">
    <div class="layui-col-xs3" style="border:2px dashed rgba(111, 94, 94, 0.27);">
        <div class="grid-demo grid-demo-bg1" style="overflow-y: auto;height: 100%;">
            <ul id="tree" class="ztree">

            </ul>
        </div>
    </div>
    <div class="layui-col-xs9">
        <div class="grid-demo" style="overflow-y: auto;height: 100%;">
            <div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a>confluence 安装指南（Linux）</h1><h1><a name='header-n3' class='md-header-anchor '></a>环境说明</h1><p>1.服务器为centos，windos端需要一个ftp工具，把需要的东西拿到Linux下。
                2.安装JDK1.8</p><h1><a name='header-n7' class='md-header-anchor '></a>需要的文件</h1><ul><li>confluence的安装包
                官网下载地址：<a href='https://www.atlassian.com/software/confluence/download' title='https://www.atlassian.com/software/confluence/download'>https://www.atlassian.com/software/confluence/download</a>
                本次下载的版本是：<strong><em>atlassian-confluence-6.3.2-x64.bin</em></strong></li><li>MySQL连接驱动程序
                这个下载渠道很多，可以通过maven仓库去下载
                下载地址：<a href='http://central.maven.org/maven2/mysql/mysql-connector-java/6.0.6/mysql-connector-java-6.0.6.jar' title='mysql-connector-java-6.0.6.jar'>mysql-connector-java-6.0.6.jar</a></li></ul><h1><a name='header-n19' class='md-header-anchor '></a>安装</h1><h2><a name='header-n20' class='md-header-anchor '></a>安装 JDK 1.8</h2><p>Linux jdk的安装这里不再说明</p><h2><a name='header-n23' class='md-header-anchor '></a>安装mysql</h2><ul><li>下载</li></ul><p>下载地址：<a href='http://dev.mysql.com/downloads/mysql/5.6.html#downloads' target='_blank' >http://dev.mysql.com/downloads/mysql/5.6.html#downloads</a>
                下载版本：我这里选择的5.6.33，通用版，linux下64位
                直接下载：<code>wget  http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.33-linux-glibc2.5-x86_64.tar.gz</code></p><ul><li>解压</li></ul><pre class="md-fences md-end-block" lang="shell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure">AخA</div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#解压</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">tar <span class="cm-attribute">-zxvf</span> mysql-5.6.33-linux-glibc2.5-x86_64.tar.gz</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#复制解压后的mysql目录</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">cp</span> <span class="cm-attribute">-r</span> mysql-5.6.33-linux-glibc2.5-x86_64 /usr/local/mysql</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><ul><li>添加用户组和用户</li></ul><pre class="md-fences md-end-block" lang="shell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#添加用户组</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">groupadd mysql</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#添加用户mysql 到用户组mysql</span></span></pre><pre class=""><span style="padding-right: 0.1px;">useradd <span class="cm-attribute">-g</span> mysql mysql</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><ul><li>安装</li></ul><pre class="md-fences md-end-block" lang="shell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#切换到mysql主目录</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> /usr/local/mysql/</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#创建mysql 数据文件夹</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">mkdir</span> ./data/mysql</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#授权</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">chown</span> <span class="cm-attribute">-R</span> mysql:mysql ./</span></pre><pre class=""><span style="padding-right: 0.1px;">./scripts/mysql_install_db <span class="cm-attribute">--user</span><span class="cm-operator">=</span>mysql <span class="cm-attribute">--datadir</span><span class="cm-operator">=</span>/usr/local/mysql/data/mysql</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">cp</span> support-files/mysql.server /etc/init.d/mysqld</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">chmod</span> <span class="cm-number">755</span> /etc/init.d/mysqld</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">cp</span> support-files/my-default.cnf /etc/my.cnf</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#修改启动脚本</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">vi</span> /etc/init.d/mysqld</span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#修改项：</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">basedir</span><span class="cm-operator">=</span>/usr/local/mysql/</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">datadir</span><span class="cm-operator">=</span>/usr/local/mysql/data/mysql</span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#启动服务</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">service</span> mysqld <span class="cm-builtin">start</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#测试连接</span></span></pre><pre class=""><span style="padding-right: 0.1px;">./mysql/bin/mysql <span class="cm-attribute">-uroot</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#加入环境变量，编辑 /etc/profile，这样可以在任何地方用mysql命令了</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">export</span> <span class="cm-def">PATH</span><span class="cm-operator">=</span><span class="cm-def">$PATH</span>:/usr/local/mysql//bin&lt;br&gt;source /etc/profile</span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#启动mysql</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">service</span> mysqld <span class="cm-builtin">start</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#关闭mysql</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">service</span> mysqld <span class="cm-builtin">stop</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#查看运行状态</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">service</span> mysqld status</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 759px;"></div></div></div></pre><ul><li>加入环境变量</li></ul><pre class="md-fences md-end-block" lang="shell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">vim</span> /etc/profile</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">export</span> <span class="cm-def">MYSQL_HOME</span><span class="cm-operator">=</span>/usr/local/mysql</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">export</span> <span class="cm-def">PATH</span><span class="cm-operator">=</span><span class="cm-def">$MYSQL_HOME</span>/bin:<span class="cm-def">$PATH</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#执行profile</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">source</span> /etc/profile</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ul><li>修改用户等选项</li></ul><pre class="md-fences md-end-block" lang="shell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#登录</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">mysql <span class="cm-attribute">-u</span> root</span></pre><pre class=""><span style="padding-right: 0.1px;">use mysql;</span></pre><pre class=""><span style="padding-right: 0.1px;">select <span class="cm-string">'host'</span> from user where <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-string">'root'</span>; </span></pre><pre class=""><span style="padding-right: 0.1px;">update user <span class="cm-keyword">set</span> host <span class="cm-operator">=</span> <span class="cm-string">'%'</span> where user <span class="cm-operator">=</span><span class="cm-string">'root'</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#修改密码</span></span></pre><pre class=""><span style="padding-right: 0.1px;">update user <span class="cm-keyword">set</span> <span class="cm-def">password</span><span class="cm-operator">=</span>password(<span class="cm-string">'123456'</span>) where <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-string">'root'</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">flush privileges; </span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><h2><a name='header-n57' class='md-header-anchor '></a>创建数据库</h2><p>两种方式，通过命令行创建、或者通过navicat 等连接工具创建，我是通过navicat工具创建的，也验证mysql连接可用</p><ul><li>创建数据库名：confluence</li></ul><h1><a name='header-n64' class='md-header-anchor '></a>安装confluence5.8.10</h1><ul><li>修改增加可执行权限</li></ul><pre class="md-fences md-end-block" lang="shell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">mv</span> atlassian-confluence-6.3.2-x64.bin confluence.bin</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#增加可执行权限</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">chown</span> u<span class="cm-operator">+</span>x confluence.bin</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><ul><li>安装</li></ul><pre class="md-fences md-end-block" lang="shell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">./confluence.bin</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">#根据提示操作安装</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"># 注意：在安装的过程中，如果你的默认目录被占用，端口8090被占用，会需要你自己设置端口号，这里安装是安装在/opt下，数据存放在/var目录下，用户目录在/home下，关于端口被占用的情况，一般是之前安装不成功，被无效的confluence用户占用了。可以使用lsof -i:8090查看是哪个进程占用了该端口，然后kill掉就OK了。如果不得不使用别的端口，记得在防火墙中开启该端口：iptables -I INPUT -p tcp -m state —state NEW -m tcp —dport xxxx -j ACCEPT</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><ul><li>访问</li></ul><p>浏览器访问：<a href='http://ip:8090/' target='_blank' >http://ip:8090/</a>
                回车后，进入安装界面，选择<code>install production</code>,然后直接跳过<code>add ones</code>，在出现serverID的时候，要保存复制</p><ul><li>获取License Key</li></ul><p>1、访问网址：<a href='http://id.atlassian.com' target='_blank' >http://id.atlassian.com</a>
                注册一个账号，也可以通过Google的Gmail账号登录（需要翻墙）</p><p>2、访问网址：<a href='https://my.atlassian.com/' title='https://my.atlassian.com/'>https://my.atlassian.com/</a>
                登录我的页面，点击页面上的<code>New Evaluation License</code> 链接，填入刚才安装界面的<code>serverID</code>，新生成一个License Key</p><p>3、上面获取的License Key 只有一个月免费</p><ul><li>配置数据库</li></ul><p>1.选择mysql，点击external database
                2.选择上面的JDBC
                3.在出现的界面上url的最后加上解决中文乱码的&amp;useUnicode=true&amp;characterEncoding=utf8
                4.输入用户名和密码，这里的数据库账户密码是之前创建的username和user code
                5.点击next如果出现已经存在xxxx的错误是因为之前安装过，直接overwrite就OK。</p><h1><a name='header-n105' class='md-header-anchor '></a>关于破解confluence</h1><p>a.停止Confluence服务器
                /opt/atlassian/confluence/bin/stop-confluence.sh
                b. 将数据库连接程序 mysql-connector-java-5.1.32-bin.jar 和汉化包：Confluence-5.8.10-language-pack-zh_CN.jar放在 atlassian\confluence\confluence\WEB-INF\lib 目录
                c. 将 atlassian\confluence\confluence\WEB-INF\lib\atlassian-extras-decoder-v2-3.2.jar 拷贝到Windows上，重命名为atlassian-extras-2.4.jar</p><p>d. 执行confluence_keygen.jar，输入一些列账户名称邮箱这些信息，输入serverID,点击Patch，选择 atlassian-extras-2.4.jar，点击gen
                e. 这时候就生成了需要的秘钥，复制下来保存。
                f.将atlassian-extras-2.4.jar重命名为原来的atlassian-extras-decoder-v2-3.2.jar，放回linux下的原位。
                f. 重新启动confluence
                /opt/atlassian/confluence/bin/start-confluence.sh
                g. 刷新浏览器，输入密钥，进入下一步</p><h1><a name='header-n119' class='md-header-anchor '></a>恢复数据</h1><p>这里等待三分钟初始化结束后，如果想要新的界面，就点击empty site，如果要恢复，就选择最下面的导入backup文件，直接从windows下导入，导入结束后会自动import，当到100%的时候，就可以start up啦。</p><p>说明：中间可能会有一些稀奇古怪的问题，可以将报错信息google，一般会找到解决办法。实在不行，建议全部卸载重来一遍。</p><p>ps -ef|grep java 看看进程，可能是启动用户有问题
                kill 掉之前起来的
                /opt/atlassian/confluence/bin/startup.sh 用这个启动
                tail -f /var/atlassian/application-data/confluence/logs/atlassian-confluence.log看下日志</p><p></p></div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        $('#tree').ztree_toc({
            is_auto_number:true
        });
    })
</script>
</body>
</html>