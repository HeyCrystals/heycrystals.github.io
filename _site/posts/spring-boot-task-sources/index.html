<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" >
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <meta name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover">

  

  

  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Spring Boot 任务task源码分析" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="Spring Boot 任务task源码分析" />
<meta property="og:description" content="Spring Boot 任务task源码分析" />
<link rel="canonical" href="/posts/spring-boot-task-sources/" />
<meta property="og:url" content="/posts/spring-boot-task-sources/" />
<meta property="og:site_name" content="八一菜刀" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-26T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Spring Boot 任务task源码分析" />
<meta name="twitter:site" content="@xiaoymin" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-10-14T18:56:43+08:00","datePublished":"2018-01-26T00:00:00+08:00","description":"Spring Boot 任务task源码分析","headline":"Spring Boot 任务task源码分析","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/spring-boot-task-sources/"},"url":"/posts/spring-boot-task-sources/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Spring Boot 任务task源码分析 | 八一菜刀
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="八一菜刀">
<meta name="application-name" content="八一菜刀">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
  
  <link rel="preconnect" href="https://fonts.googleapis.com" >
  <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
  
  <link rel="preconnect" href="https://fonts.googleapis.com" >
  <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
  
  <link rel="preconnect" href="https://cdn.jsdelivr.net" >
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
  

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.2/dist/tocbot.min.css">
  

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
  <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>

  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/images/common/avatar.jpeg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <h1 class="site-title">
      <a href="/">八一菜刀</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">Speak less,Do more</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>分类</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>标签</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/xiaoymin"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/xiaoymin"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['xiaoymin','foxmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>Spring Boot 任务task源码分析</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Spring Boot 任务task源码分析</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1516896000"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2018/01/26
</time>

      </span>

      <!-- lastmod date -->
      
      <span>
        更新于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1697281003"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2023/10/14
</time>

      </span>
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
            
            <a href="https://twitter.com/xiaoymin">xiaoymin</a>
            

          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4137 字"
>
  <em>22 分钟</em>阅读</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <h2 id="enablescheduling注解"><span class="me-2">EnableScheduling注解</span><a href="#enablescheduling注解" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>在Spring Boot中添加任务job时,已提供很好的支持,只需在SpringBoot启动类加<code class="language-plaintext highlighter-rouge">@EnableScheduling</code>注解即可</p>

<p>如：</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.lishiots.lshui</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.annotation.EnableScheduling</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableScheduling</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApiApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ApiApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></div></div>

<p>EnableScheduling注解源码：</p>

<p>1、导入<code class="language-plaintext highlighter-rouge">SchedulingConfiguration</code>配置</p>

<p>2、注入<code class="language-plaintext highlighter-rouge">ScheduledAnnotationBeanPostProcessor</code>Bean实例</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
</pre></td><td class="rouge-code"><pre><span class="cm">/*
 * Copyright 2002-2016 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="kn">package</span> <span class="nn">org.springframework.scheduling.annotation</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Documented</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.ElementType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.Trigger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.config.ScheduledTaskRegistrar</span><span class="o">;</span>

<span class="cm">/**
 * Enables Spring's scheduled task execution capability, similar to
 * functionality found in Spring's {@code &lt;task:*&gt;} XML namespace. To be used
 * on @{@link Configuration} classes as follows:
 *
 * &lt;pre class="code"&gt;
 * &amp;#064;Configuration
 * &amp;#064;EnableScheduling
 * public class AppConfig {
 *
 *     // various &amp;#064;Bean definitions
 * }&lt;/pre&gt;
 *
 * This enables detection of @{@link Scheduled} annotations on any Spring-managed
 * bean in the container. For example, given a class {@code MyTask}
 *
 * &lt;pre class="code"&gt;
 * package com.myco.tasks;
 *
 * public class MyTask {
 *
 *     &amp;#064;Scheduled(fixedRate=1000)
 *     public void work() {
 *         // task execution logic
 *     }
 * }&lt;/pre&gt;
 *
 * the following configuration would ensure that {@code MyTask.work()} is called
 * once every 1000 ms:
 *
 * &lt;pre class="code"&gt;
 * &amp;#064;Configuration
 * &amp;#064;EnableScheduling
 * public class AppConfig {
 *
 *     &amp;#064;Bean
 *     public MyTask task() {
 *         return new MyTask();
 *     }
 * }&lt;/pre&gt;
 *
 * Alternatively, if {@code MyTask} were annotated with {@code @Component}, the
 * following configuration would ensure that its {@code @Scheduled} method is
 * invoked at the desired interval:
 *
 * &lt;pre class="code"&gt;
 * &amp;#064;Configuration
 * &amp;#064;EnableScheduling
 * &amp;#064;ComponentScan(basePackages="com.myco.tasks")
 * public class AppConfig {
 * }&lt;/pre&gt;
 *
 * Methods annotated with {@code @Scheduled} may even be declared directly within
 * {@code @Configuration} classes:
 *
 * &lt;pre class="code"&gt;
 * &amp;#064;Configuration
 * &amp;#064;EnableScheduling
 * public class AppConfig {
 *
 *     &amp;#064;Scheduled(fixedRate=1000)
 *     public void work() {
 *         // task execution logic
 *     }
 * }&lt;/pre&gt;
 *
 * &lt;p&gt;By default, will be searching for an associated scheduler definition: either
 * a unique {@link org.springframework.scheduling.TaskScheduler} bean in the context,
 * or a {@code TaskScheduler} bean named "taskScheduler" otherwise; the same lookup
 * will also be performed for a {@link java.util.concurrent.ScheduledExecutorService}
 * bean. If neither of the two is resolvable, a local single-threaded default
 * scheduler will be created and used within the registrar.
 *
 * &lt;p&gt;When more control is desired, a {@code @Configuration} class may implement
 * {@link SchedulingConfigurer}. This allows access to the underlying
 * {@link ScheduledTaskRegistrar} instance. For example, the following example
 * demonstrates how to customize the {@link Executor} used to execute scheduled
 * tasks:
 *
 * &lt;pre class="code"&gt;
 * &amp;#064;Configuration
 * &amp;#064;EnableScheduling
 * public class AppConfig implements SchedulingConfigurer {
 *
 *     &amp;#064;Override
 *     public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {
 *         taskRegistrar.setScheduler(taskExecutor());
 *     }
 *
 *     &amp;#064;Bean(destroyMethod="shutdown")
 *     public Executor taskExecutor() {
 *         return Executors.newScheduledThreadPool(100);
 *     }
 * }&lt;/pre&gt;
 *
 * &lt;p&gt;Note in the example above the use of {@code @Bean(destroyMethod="shutdown")}.
 * This ensures that the task executor is properly shut down when the Spring
 * application context itself is closed.
 *
 * &lt;p&gt;Implementing {@code SchedulingConfigurer} also allows for fine-grained
 * control over task registration via the {@code ScheduledTaskRegistrar}.
 * For example, the following configures the execution of a particular bean
 * method per a custom {@code Trigger} implementation:
 *
 * &lt;pre class="code"&gt;
 * &amp;#064;Configuration
 * &amp;#064;EnableScheduling
 * public class AppConfig implements SchedulingConfigurer {
 *
 *     &amp;#064;Override
 *     public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {
 *         taskRegistrar.setScheduler(taskScheduler());
 *         taskRegistrar.addTriggerTask(
 *             new Runnable() {
 *                 public void run() {
 *                     myTask().work();
 *                 }
 *             },
 *             new CustomTrigger()
 *         );
 *     }
 *
 *     &amp;#064;Bean(destroyMethod="shutdown")
 *     public Executor taskScheduler() {
 *         return Executors.newScheduledThreadPool(42);
 *     }
 *
 *     &amp;#064;Bean
 *     public MyTask myTask() {
 *         return new MyTask();
 *     }
 * }&lt;/pre&gt;
 *
 * &lt;p&gt;For reference, the example above can be compared to the following Spring XML
 * configuration:
 *
 * &lt;pre class="code"&gt;
 * {@code
 * &lt;beans&gt;
 *
 *     &lt;task:annotation-driven scheduler="taskScheduler"/&gt;
 *
 *     &lt;task:scheduler id="taskScheduler" pool-size="42"/&gt;
 *
 *     &lt;task:scheduled-tasks scheduler="taskScheduler"&gt;
 *         &lt;task:scheduled ref="myTask" method="work" fixed-rate="1000"/&gt;
 *     &lt;/task:scheduled-tasks&gt;
 *
 *     &lt;bean id="myTask" class="com.foo.MyTask"/&gt;
 *
 * &lt;/beans&gt;
 * }&lt;/pre&gt;
 *
 * The examples are equivalent save that in XML a &lt;em&gt;fixed-rate&lt;/em&gt; period is used
 * instead of a custom &lt;em&gt;{@code Trigger}&lt;/em&gt; implementation; this is because the
 * {@code task:} namespace {@code scheduled} cannot easily expose such support. This is
 * but one demonstration how the code-based approach allows for maximum configurability
 * through direct access to actual componentry.&lt;p&gt;
 *
 * @author Chris Beams
 * @author Juergen Hoeller
 * @since 3.1
 * @see Scheduled
 * @see SchedulingConfiguration
 * @see SchedulingConfigurer
 * @see ScheduledTaskRegistrar
 * @see Trigger
 * @see ScheduledAnnotationBeanPostProcessor
 */</span>
<span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Import</span><span class="o">(</span><span class="nc">SchedulingConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">EnableScheduling</span> <span class="o">{</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>##Scheduled注解</p>

<p>job类只需在方法上加<code class="language-plaintext highlighter-rouge">@Scheduled</code>注解即可,支持cron表达式</p>

<p>例如：</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="cm">/***
 *
 * @since:screen-api 1.0
 * @author &lt;a href="mailto:xiaoymin@foxmail.com"&gt;xiaoymin@foxmail.com&lt;/a&gt; 
 * 2018/01/22 13:44
 */</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JgJob</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">JgJob</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Autowired</span>
    <span class="nc">JgService</span> <span class="n">jgService</span><span class="o">;</span>

    <span class="nd">@Scheduled</span><span class="o">(</span><span class="n">cron</span> <span class="o">=</span> <span class="s">"0 0/2 * * * ?"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">jgFlowJob</span><span class="o">(){</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"同步极光数据任务开始..."</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="k">new</span> <span class="nc">DateTime</span><span class="o">().</span><span class="na">toString</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">));</span>
        <span class="nc">String</span> <span class="n">date</span><span class="o">=</span><span class="nc">DateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">toString</span><span class="o">(</span><span class="s">"yyyyMMddHHmm"</span><span class="o">);</span>
        <span class="n">jgService</span><span class="o">.</span><span class="na">syncJgTouristFlow</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"同步极光数据任务结束..."</span><span class="o">);</span>
    <span class="o">}</span>
  
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>查看<code class="language-plaintext highlighter-rouge">Scheduled</code>注解源码：</p>

<ul>
  <li>使用该注解标注的方法将会被执行，指定cron或者fxedDelay或者fixedRate属性</li>
  <li>该注解标注必须无参数,如果有返回参数,将会被忽略</li>
  <li>通过类<code class="language-plaintext highlighter-rouge">ScheduledAnnotationBeanPostProcessor</code>注入</li>
</ul>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * An annotation that marks a method to be scheduled. Exactly one of
 * the {@link #cron()}, {@link #fixedDelay()}, or {@link #fixedRate()}
 * attributes must be specified.
 *
 * &lt;p&gt;The annotated method must expect no arguments. It will typically have
 * a {@code void} return type; if not, the returned value will be ignored
 * when called through the scheduler.
 *
 * &lt;p&gt;Processing of {@code @Scheduled} annotations is performed by
 * registering a {@link ScheduledAnnotationBeanPostProcessor}. This can be
 * done manually or, more conveniently, through the {@code &lt;task:annotation-driven/&gt;}
 * element or @{@link EnableScheduling} annotation.
 *
 * &lt;p&gt;This annotation may be used as a &lt;em&gt;meta-annotation&lt;/em&gt; to create custom
 * &lt;em&gt;composed annotations&lt;/em&gt; with attribute overrides.
 *
 * @author Mark Fisher
 * @author Dave Syer
 * @author Chris Beams
 * @since 3.0
 * @see EnableScheduling
 * @see ScheduledAnnotationBeanPostProcessor
 * @see Schedules
 */</span>
<span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">ANNOTATION_TYPE</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="nd">@Repeatable</span><span class="o">(</span><span class="nc">Schedules</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Scheduled</span> <span class="o">{</span>
 <span class="o">....</span> 
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>##SchedulingConfiguration</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * {@code @Configuration} class that registers a {@link ScheduledAnnotationBeanPostProcessor}
 * bean capable of processing Spring's @{@link Scheduled} annotation.
 *
 * &lt;p&gt;This configuration class is automatically imported when using the
 * {@link EnableScheduling @EnableScheduling} annotation. See
 * {@code @EnableScheduling}'s javadoc for complete usage details.
 *
 * @author Chris Beams
 * @since 3.1
 * @see EnableScheduling
 * @see ScheduledAnnotationBeanPostProcessor
 */</span>
<span class="nd">@Configuration</span>
<span class="nd">@Role</span><span class="o">(</span><span class="nc">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchedulingConfiguration</span> <span class="o">{</span>

	<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="nc">TaskManagementConfigUtils</span><span class="o">.</span><span class="na">SCHEDULED_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="o">)</span>
	<span class="nd">@Role</span><span class="o">(</span><span class="nc">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">ScheduledAnnotationBeanPostProcessor</span> <span class="nf">scheduledAnnotationProcessor</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">ScheduledAnnotationBeanPostProcessor</span><span class="o">();</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="scheduledannotationbeanpostprocessor"><span class="me-2">ScheduledAnnotationBeanPostProcessor</span><a href="#scheduledannotationbeanpostprocessor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
</pre></td><td class="rouge-code"><pre><span class="cm">/*
 * Copyright 2002-2017 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="kn">package</span> <span class="nn">org.springframework.scheduling.annotation</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.IdentityHashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedHashSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TimeZone</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ScheduledExecutorService</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.logging.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.LogFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.aop.support.AopUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.BeanFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.BeanFactoryAware</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.BeanNameAware</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.DisposableBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.ListableBeanFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.NoSuchBeanDefinitionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.NoUniqueBeanDefinitionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.SmartInitializingSingleton</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.AutowireCapableBeanFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.ConfigurableBeanFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.NamedBeanHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.support.MergedBeanDefinitionPostProcessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.support.RootBeanDefinition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContextAware</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.EmbeddedValueResolverAware</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.event.ContextRefreshedEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.MethodIntrospector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.Ordered</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.annotation.AnnotatedElementUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.TaskScheduler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.Trigger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.config.CronTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.config.IntervalTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.config.ScheduledTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.config.ScheduledTaskRegistrar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.support.CronTrigger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.support.ScheduledMethodRunnable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.StringValueResolver</span><span class="o">;</span>

<span class="cm">/**
 * Bean post-processor that registers methods annotated with @{@link Scheduled}
 * to be invoked by a {@link org.springframework.scheduling.TaskScheduler} according
 * to the "fixedRate", "fixedDelay", or "cron" expression provided via the annotation.
 *
 * &lt;p&gt;This post-processor is automatically registered by Spring's
 * {@code &lt;task:annotation-driven&gt;} XML element, and also by the
 * {@link EnableScheduling @EnableScheduling} annotation.
 *
 * &lt;p&gt;Autodetects any {@link SchedulingConfigurer} instances in the container,
 * allowing for customization of the scheduler to be used or for fine-grained
 * control over task registration (e.g. registration of {@link Trigger} tasks.
 * See the @{@link EnableScheduling} javadocs for complete usage details.
 *
 * @author Mark Fisher
 * @author Juergen Hoeller
 * @author Chris Beams
 * @author Elizabeth Chatman
 * @since 3.0
 * @see Scheduled
 * @see EnableScheduling
 * @see SchedulingConfigurer
 * @see org.springframework.scheduling.TaskScheduler
 * @see org.springframework.scheduling.config.ScheduledTaskRegistrar
 * @see AsyncAnnotationBeanPostProcessor
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScheduledAnnotationBeanPostProcessor</span>
		<span class="kd">implements</span> <span class="nc">MergedBeanDefinitionPostProcessor</span><span class="o">,</span> <span class="nc">DestructionAwareBeanPostProcessor</span><span class="o">,</span>
		<span class="nc">Ordered</span><span class="o">,</span> <span class="nc">EmbeddedValueResolverAware</span><span class="o">,</span> <span class="nc">BeanNameAware</span><span class="o">,</span> <span class="nc">BeanFactoryAware</span><span class="o">,</span> <span class="nc">ApplicationContextAware</span><span class="o">,</span>
		<span class="nc">SmartInitializingSingleton</span><span class="o">,</span> <span class="nc">ApplicationListener</span><span class="o">&lt;</span><span class="nc">ContextRefreshedEvent</span><span class="o">&gt;,</span> <span class="nc">DisposableBean</span> <span class="o">{</span>

	<span class="cm">/**
	 * The default name of the {@link TaskScheduler} bean to pick up: "taskScheduler".
	 * &lt;p&gt;Note that the initial lookup happens by type; this is just the fallback
	 * in case of multiple scheduler beans found in the context.
	 * @since 4.2
	 */</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">DEFAULT_TASK_SCHEDULER_BEAN_NAME</span> <span class="o">=</span> <span class="s">"taskScheduler"</span><span class="o">;</span>


	<span class="kd">protected</span> <span class="kd">final</span> <span class="nc">Log</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="n">getClass</span><span class="o">());</span>

	<span class="kd">private</span> <span class="nc">Object</span> <span class="n">scheduler</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">StringValueResolver</span> <span class="n">embeddedValueResolver</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">beanName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BeanFactory</span> <span class="n">beanFactory</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">ScheduledTaskRegistrar</span> <span class="n">registrar</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScheduledTaskRegistrar</span><span class="o">();</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">nonAnnotatedClasses</span> <span class="o">=</span>
			<span class="nc">Collections</span><span class="o">.</span><span class="na">newSetFromMap</span><span class="o">(</span><span class="k">new</span> <span class="nc">ConcurrentHashMap</span><span class="o">&lt;</span><span class="nc">Class</span><span class="o">&lt;?&gt;,</span> <span class="nc">Boolean</span><span class="o">&gt;(</span><span class="mi">64</span><span class="o">));</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;&gt;</span> <span class="n">scheduledTasks</span> <span class="o">=</span>
			<span class="k">new</span> <span class="nc">IdentityHashMap</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;&gt;(</span><span class="mi">16</span><span class="o">);</span>


	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="no">LOWEST_PRECEDENCE</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="cm">/**
	 * Set the {@link org.springframework.scheduling.TaskScheduler} that will invoke
	 * the scheduled methods, or a {@link java.util.concurrent.ScheduledExecutorService}
	 * to be wrapped as a TaskScheduler.
	 * &lt;p&gt;If not specified, default scheduler resolution will apply: searching for a
	 * unique {@link TaskScheduler} bean in the context, or for a {@link TaskScheduler}
	 * bean named "taskScheduler" otherwise; the same lookup will also be performed for
	 * a {@link ScheduledExecutorService} bean. If neither of the two is resolvable,
	 * a local single-threaded default scheduler will be created within the registrar.
	 * @see #DEFAULT_TASK_SCHEDULER_BEAN_NAME
	 */</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setScheduler</span><span class="o">(</span><span class="nc">Object</span> <span class="n">scheduler</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">scheduler</span> <span class="o">=</span> <span class="n">scheduler</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmbeddedValueResolver</span><span class="o">(</span><span class="nc">StringValueResolver</span> <span class="n">resolver</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBeanName</span><span class="o">(</span><span class="nc">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">beanName</span> <span class="o">=</span> <span class="n">beanName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="cm">/**
	 * Making a {@link BeanFactory} available is optional; if not set,
	 * {@link SchedulingConfigurer} beans won't get autodetected and
	 * a {@link #setScheduler scheduler} has to be explicitly configured.
	 */</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBeanFactory</span><span class="o">(</span><span class="nc">BeanFactory</span> <span class="n">beanFactory</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span> <span class="o">=</span> <span class="n">beanFactory</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="cm">/**
	 * Setting an {@link ApplicationContext} is optional: If set, registered
	 * tasks will be activated in the {@link ContextRefreshedEvent} phase;
	 * if not set, it will happen at {@link #afterSingletonsInstantiated} time.
	 */</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setApplicationContext</span><span class="o">(</span><span class="nc">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">;</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>


	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterSingletonsInstantiated</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// Remove resolved singleton classes from cache</span>
		<span class="k">this</span><span class="o">.</span><span class="na">nonAnnotatedClasses</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// Not running in an ApplicationContext -&gt; register tasks early...</span>
			<span class="n">finishRegistration</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onApplicationEvent</span><span class="o">(</span><span class="nc">ContextRefreshedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">()</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// Running in an ApplicationContext -&gt; register tasks this late...</span>
			<span class="c1">// giving other ContextRefreshedEvent listeners a chance to perform</span>
			<span class="c1">// their work at the same time (e.g. Spring Batch's job registration).</span>
			<span class="n">finishRegistration</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">finishRegistration</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">scheduler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">setScheduler</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">scheduler</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span> <span class="k">instanceof</span> <span class="nc">ListableBeanFactory</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SchedulingConfigurer</span><span class="o">&gt;</span> <span class="n">configurers</span> <span class="o">=</span>
					<span class="o">((</span><span class="nc">ListableBeanFactory</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span><span class="o">).</span><span class="na">getBeansOfType</span><span class="o">(</span><span class="nc">SchedulingConfigurer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="k">for</span> <span class="o">(</span><span class="nc">SchedulingConfigurer</span> <span class="n">configurer</span> <span class="o">:</span> <span class="n">configurers</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
				<span class="n">configurer</span><span class="o">.</span><span class="na">configureTasks</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">hasTasks</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">getScheduler</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">Assert</span><span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">,</span> <span class="s">"BeanFactory must be set to find scheduler by type"</span><span class="o">);</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="c1">// Search for TaskScheduler bean...</span>
				<span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">setTaskScheduler</span><span class="o">(</span><span class="n">resolveSchedulerBean</span><span class="o">(</span><span class="nc">TaskScheduler</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">false</span><span class="o">));</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">NoUniqueBeanDefinitionException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Could not find unique TaskScheduler bean"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">setTaskScheduler</span><span class="o">(</span><span class="n">resolveSchedulerBean</span><span class="o">(</span><span class="nc">TaskScheduler</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">));</span>
				<span class="o">}</span>
				<span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchBeanDefinitionException</span> <span class="n">ex2</span><span class="o">)</span> <span class="o">{</span>
					<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
						<span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"More than one TaskScheduler bean exists within the context, and "</span> <span class="o">+</span>
								<span class="s">"none is named 'taskScheduler'. Mark one of them as primary or name it 'taskScheduler' "</span> <span class="o">+</span>
								<span class="s">"(possibly as an alias); or implement the SchedulingConfigurer interface and call "</span> <span class="o">+</span>
								<span class="s">"ScheduledTaskRegistrar#setScheduler explicitly within the configureTasks() callback: "</span> <span class="o">+</span>
								<span class="n">ex</span><span class="o">.</span><span class="na">getBeanNamesFound</span><span class="o">());</span>
					<span class="o">}</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchBeanDefinitionException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Could not find default TaskScheduler bean"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
				<span class="c1">// Search for ScheduledExecutorService bean next...</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">setScheduler</span><span class="o">(</span><span class="n">resolveSchedulerBean</span><span class="o">(</span><span class="nc">ScheduledExecutorService</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">false</span><span class="o">));</span>
				<span class="o">}</span>
				<span class="k">catch</span> <span class="o">(</span><span class="nc">NoUniqueBeanDefinitionException</span> <span class="n">ex2</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Could not find unique ScheduledExecutorService bean"</span><span class="o">,</span> <span class="n">ex2</span><span class="o">);</span>
					<span class="k">try</span> <span class="o">{</span>
						<span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">setScheduler</span><span class="o">(</span><span class="n">resolveSchedulerBean</span><span class="o">(</span><span class="nc">ScheduledExecutorService</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">));</span>
					<span class="o">}</span>
					<span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchBeanDefinitionException</span> <span class="n">ex3</span><span class="o">)</span> <span class="o">{</span>
						<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
							<span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"More than one ScheduledExecutorService bean exists within the context, and "</span> <span class="o">+</span>
									<span class="s">"none is named 'taskScheduler'. Mark one of them as primary or name it 'taskScheduler' "</span> <span class="o">+</span>
									<span class="s">"(possibly as an alias); or implement the SchedulingConfigurer interface and call "</span> <span class="o">+</span>
									<span class="s">"ScheduledTaskRegistrar#setScheduler explicitly within the configureTasks() callback: "</span> <span class="o">+</span>
									<span class="n">ex2</span><span class="o">.</span><span class="na">getBeanNamesFound</span><span class="o">());</span>
						<span class="o">}</span>
					<span class="o">}</span>
				<span class="o">}</span>
				<span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchBeanDefinitionException</span> <span class="n">ex2</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Could not find default ScheduledExecutorService bean"</span><span class="o">,</span> <span class="n">ex2</span><span class="o">);</span>
					<span class="c1">// Giving up -&gt; falling back to default scheduler within the registrar...</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"No TaskScheduler/ScheduledExecutorService bean found for scheduled processing"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">afterPropertiesSet</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">resolveSchedulerBean</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">schedulerType</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">byName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">byName</span><span class="o">)</span> <span class="o">{</span>
			<span class="no">T</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="no">DEFAULT_TASK_SCHEDULER_BEAN_NAME</span><span class="o">,</span> <span class="n">schedulerType</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span> <span class="k">instanceof</span> <span class="nc">ConfigurableBeanFactory</span><span class="o">)</span> <span class="o">{</span>
				<span class="o">((</span><span class="nc">ConfigurableBeanFactory</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span><span class="o">).</span><span class="na">registerDependentBean</span><span class="o">(</span>
						<span class="no">DEFAULT_TASK_SCHEDULER_BEAN_NAME</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">beanName</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">return</span> <span class="n">scheduler</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span> <span class="k">instanceof</span> <span class="nc">AutowireCapableBeanFactory</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">NamedBeanHolder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">holder</span> <span class="o">=</span> <span class="o">((</span><span class="nc">AutowireCapableBeanFactory</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span><span class="o">).</span><span class="na">resolveNamedBean</span><span class="o">(</span><span class="n">schedulerType</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span> <span class="k">instanceof</span> <span class="nc">ConfigurableBeanFactory</span><span class="o">)</span> <span class="o">{</span>
				<span class="o">((</span><span class="nc">ConfigurableBeanFactory</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span><span class="o">).</span><span class="na">registerDependentBean</span><span class="o">(</span>
						<span class="n">holder</span><span class="o">.</span><span class="na">getBeanName</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">beanName</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">return</span> <span class="n">holder</span><span class="o">.</span><span class="na">getBeanInstance</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">beanFactory</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">schedulerType</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>


	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postProcessMergedBeanDefinition</span><span class="o">(</span><span class="nc">RootBeanDefinition</span> <span class="n">beanDefinition</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">beanType</span><span class="o">,</span> <span class="nc">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">postProcessBeforeInitialization</span><span class="o">(</span><span class="nc">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="nc">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">postProcessAfterInitialization</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="nc">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">targetClass</span> <span class="o">=</span> <span class="nc">AopUtils</span><span class="o">.</span><span class="na">getTargetClass</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">nonAnnotatedClasses</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">targetClass</span><span class="o">))</span> <span class="o">{</span>
			<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Method</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Scheduled</span><span class="o">&gt;&gt;</span> <span class="n">annotatedMethods</span> <span class="o">=</span> <span class="nc">MethodIntrospector</span><span class="o">.</span><span class="na">selectMethods</span><span class="o">(</span><span class="n">targetClass</span><span class="o">,</span>
					<span class="k">new</span> <span class="nc">MethodIntrospector</span><span class="o">.</span><span class="na">MetadataLookup</span><span class="o">&lt;</span><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Scheduled</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
						<span class="nd">@Override</span>
						<span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Scheduled</span><span class="o">&gt;</span> <span class="nf">inspect</span><span class="o">(</span><span class="nc">Method</span> <span class="n">method</span><span class="o">)</span> <span class="o">{</span>
							<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Scheduled</span><span class="o">&gt;</span> <span class="n">scheduledMethods</span> <span class="o">=</span> <span class="nc">AnnotatedElementUtils</span><span class="o">.</span><span class="na">getMergedRepeatableAnnotations</span><span class="o">(</span>
									<span class="n">method</span><span class="o">,</span> <span class="nc">Scheduled</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">Schedules</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
							<span class="k">return</span> <span class="o">(!</span><span class="n">scheduledMethods</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">?</span> <span class="n">scheduledMethods</span> <span class="o">:</span> <span class="kc">null</span><span class="o">);</span>
						<span class="o">}</span>
					<span class="o">});</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">annotatedMethods</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="na">nonAnnotatedClasses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">targetClass</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"No @Scheduled annotations found on bean class: "</span> <span class="o">+</span> <span class="n">bean</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="c1">// Non-empty set of methods</span>
				<span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Method</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Scheduled</span><span class="o">&gt;&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">annotatedMethods</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
					<span class="nc">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
					<span class="k">for</span> <span class="o">(</span><span class="nc">Scheduled</span> <span class="n">scheduled</span> <span class="o">:</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">())</span> <span class="o">{</span>
						<span class="n">processScheduled</span><span class="o">(</span><span class="n">scheduled</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">bean</span><span class="o">);</span>
					<span class="o">}</span>
				<span class="o">}</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="n">annotatedMethods</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">" @Scheduled methods processed on bean '"</span> <span class="o">+</span> <span class="n">beanName</span> <span class="o">+</span>
							<span class="s">"': "</span> <span class="o">+</span> <span class="n">annotatedMethods</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">processScheduled</span><span class="o">(</span><span class="nc">Scheduled</span> <span class="n">scheduled</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getParameterTypes</span><span class="o">().</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">,</span>
					<span class="s">"Only no-arg methods may be annotated with @Scheduled"</span><span class="o">);</span>

			<span class="nc">Method</span> <span class="n">invocableMethod</span> <span class="o">=</span> <span class="nc">AopUtils</span><span class="o">.</span><span class="na">selectInvocableMethod</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">bean</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
			<span class="nc">Runnable</span> <span class="n">runnable</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScheduledMethodRunnable</span><span class="o">(</span><span class="n">bean</span><span class="o">,</span> <span class="n">invocableMethod</span><span class="o">);</span>
			<span class="kt">boolean</span> <span class="n">processedSchedule</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
			<span class="nc">String</span> <span class="n">errorMessage</span> <span class="o">=</span>
					<span class="s">"Exactly one of the 'cron', 'fixedDelay(String)', or 'fixedRate(String)' attributes is required"</span><span class="o">;</span>

			<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;</span> <span class="n">tasks</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;(</span><span class="mi">4</span><span class="o">);</span>

			<span class="c1">// Determine initial delay</span>
			<span class="kt">long</span> <span class="n">initialDelay</span> <span class="o">=</span> <span class="n">scheduled</span><span class="o">.</span><span class="na">initialDelay</span><span class="o">();</span>
			<span class="nc">String</span> <span class="n">initialDelayString</span> <span class="o">=</span> <span class="n">scheduled</span><span class="o">.</span><span class="na">initialDelayString</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">initialDelayString</span><span class="o">))</span> <span class="o">{</span>
				<span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="n">initialDelay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">,</span> <span class="s">"Specify 'initialDelay' or 'initialDelayString', not both"</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">initialDelayString</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span><span class="o">.</span><span class="na">resolveStringValue</span><span class="o">(</span><span class="n">initialDelayString</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="n">initialDelay</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">initialDelayString</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">catch</span> <span class="o">(</span><span class="nc">NumberFormatException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
					<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span>
							<span class="s">"Invalid initialDelayString value \""</span> <span class="o">+</span> <span class="n">initialDelayString</span> <span class="o">+</span> <span class="s">"\" - cannot parse into integer"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>

			<span class="c1">// Check cron expression</span>
			<span class="nc">String</span> <span class="n">cron</span> <span class="o">=</span> <span class="n">scheduled</span><span class="o">.</span><span class="na">cron</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">cron</span><span class="o">))</span> <span class="o">{</span>
				<span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="n">initialDelay</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="s">"'initialDelay' not supported for cron triggers"</span><span class="o">);</span>
				<span class="n">processedSchedule</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
				<span class="nc">String</span> <span class="n">zone</span> <span class="o">=</span> <span class="n">scheduled</span><span class="o">.</span><span class="na">zone</span><span class="o">();</span>
				<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">cron</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span><span class="o">.</span><span class="na">resolveStringValue</span><span class="o">(</span><span class="n">cron</span><span class="o">);</span>
					<span class="n">zone</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span><span class="o">.</span><span class="na">resolveStringValue</span><span class="o">(</span><span class="n">zone</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="nc">TimeZone</span> <span class="n">timeZone</span><span class="o">;</span>
				<span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">zone</span><span class="o">))</span> <span class="o">{</span>
					<span class="n">timeZone</span> <span class="o">=</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">parseTimeZoneString</span><span class="o">(</span><span class="n">zone</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">else</span> <span class="o">{</span>
					<span class="n">timeZone</span> <span class="o">=</span> <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span>
				<span class="o">}</span>
				<span class="n">tasks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">scheduleCronTask</span><span class="o">(</span><span class="k">new</span> <span class="nc">CronTask</span><span class="o">(</span><span class="n">runnable</span><span class="o">,</span> <span class="k">new</span> <span class="nc">CronTrigger</span><span class="o">(</span><span class="n">cron</span><span class="o">,</span> <span class="n">timeZone</span><span class="o">))));</span>
			<span class="o">}</span>

			<span class="c1">// At this point we don't need to differentiate between initial delay set or not anymore</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">initialDelay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">initialDelay</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
			<span class="o">}</span>

			<span class="c1">// Check fixed delay</span>
			<span class="kt">long</span> <span class="n">fixedDelay</span> <span class="o">=</span> <span class="n">scheduled</span><span class="o">.</span><span class="na">fixedDelay</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">fixedDelay</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(!</span><span class="n">processedSchedule</span><span class="o">,</span> <span class="n">errorMessage</span><span class="o">);</span>
				<span class="n">processedSchedule</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
				<span class="n">tasks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">scheduleFixedDelayTask</span><span class="o">(</span><span class="k">new</span> <span class="nc">IntervalTask</span><span class="o">(</span><span class="n">runnable</span><span class="o">,</span> <span class="n">fixedDelay</span><span class="o">,</span> <span class="n">initialDelay</span><span class="o">)));</span>
			<span class="o">}</span>
			<span class="nc">String</span> <span class="n">fixedDelayString</span> <span class="o">=</span> <span class="n">scheduled</span><span class="o">.</span><span class="na">fixedDelayString</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">fixedDelayString</span><span class="o">))</span> <span class="o">{</span>
				<span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(!</span><span class="n">processedSchedule</span><span class="o">,</span> <span class="n">errorMessage</span><span class="o">);</span>
				<span class="n">processedSchedule</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
				<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">fixedDelayString</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span><span class="o">.</span><span class="na">resolveStringValue</span><span class="o">(</span><span class="n">fixedDelayString</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="n">fixedDelay</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">fixedDelayString</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">catch</span> <span class="o">(</span><span class="nc">NumberFormatException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
					<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span>
							<span class="s">"Invalid fixedDelayString value \""</span> <span class="o">+</span> <span class="n">fixedDelayString</span> <span class="o">+</span> <span class="s">"\" - cannot parse into integer"</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="n">tasks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">scheduleFixedDelayTask</span><span class="o">(</span><span class="k">new</span> <span class="nc">IntervalTask</span><span class="o">(</span><span class="n">runnable</span><span class="o">,</span> <span class="n">fixedDelay</span><span class="o">,</span> <span class="n">initialDelay</span><span class="o">)));</span>
			<span class="o">}</span>

			<span class="c1">// Check fixed rate</span>
			<span class="kt">long</span> <span class="n">fixedRate</span> <span class="o">=</span> <span class="n">scheduled</span><span class="o">.</span><span class="na">fixedRate</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">fixedRate</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(!</span><span class="n">processedSchedule</span><span class="o">,</span> <span class="n">errorMessage</span><span class="o">);</span>
				<span class="n">processedSchedule</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
				<span class="n">tasks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">scheduleFixedRateTask</span><span class="o">(</span><span class="k">new</span> <span class="nc">IntervalTask</span><span class="o">(</span><span class="n">runnable</span><span class="o">,</span> <span class="n">fixedRate</span><span class="o">,</span> <span class="n">initialDelay</span><span class="o">)));</span>
			<span class="o">}</span>
			<span class="nc">String</span> <span class="n">fixedRateString</span> <span class="o">=</span> <span class="n">scheduled</span><span class="o">.</span><span class="na">fixedRateString</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">fixedRateString</span><span class="o">))</span> <span class="o">{</span>
				<span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(!</span><span class="n">processedSchedule</span><span class="o">,</span> <span class="n">errorMessage</span><span class="o">);</span>
				<span class="n">processedSchedule</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
				<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">fixedRateString</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">embeddedValueResolver</span><span class="o">.</span><span class="na">resolveStringValue</span><span class="o">(</span><span class="n">fixedRateString</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="n">fixedRate</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">fixedRateString</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">catch</span> <span class="o">(</span><span class="nc">NumberFormatException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
					<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span>
							<span class="s">"Invalid fixedRateString value \""</span> <span class="o">+</span> <span class="n">fixedRateString</span> <span class="o">+</span> <span class="s">"\" - cannot parse into integer"</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="n">tasks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">scheduleFixedRateTask</span><span class="o">(</span><span class="k">new</span> <span class="nc">IntervalTask</span><span class="o">(</span><span class="n">runnable</span><span class="o">,</span> <span class="n">fixedRate</span><span class="o">,</span> <span class="n">initialDelay</span><span class="o">)));</span>
			<span class="o">}</span>

			<span class="c1">// Check whether we had any attribute set</span>
			<span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="n">processedSchedule</span><span class="o">,</span> <span class="n">errorMessage</span><span class="o">);</span>

			<span class="c1">// Finally register the scheduled tasks</span>
			<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;</span> <span class="n">registeredTasks</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">registeredTasks</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">registeredTasks</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;(</span><span class="mi">4</span><span class="o">);</span>
					<span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">bean</span><span class="o">,</span> <span class="n">registeredTasks</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="n">registeredTasks</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">tasks</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalArgumentException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span>
					<span class="s">"Encountered invalid @Scheduled method '"</span> <span class="o">+</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"': "</span> <span class="o">+</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
		<span class="o">}</span>
	<span class="o">}</span>


	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postProcessBeforeDestruction</span><span class="o">(</span><span class="nc">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="nc">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;</span> <span class="n">tasks</span><span class="o">;</span>
		<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">tasks</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">tasks</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">for</span> <span class="o">(</span><span class="nc">ScheduledTask</span> <span class="n">task</span> <span class="o">:</span> <span class="n">tasks</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">task</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">requiresDestruction</span><span class="o">(</span><span class="nc">Object</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
		<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;&gt;</span> <span class="n">allTasks</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">.</span><span class="na">values</span><span class="o">();</span>
			<span class="k">for</span> <span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ScheduledTask</span><span class="o">&gt;</span> <span class="n">tasks</span> <span class="o">:</span> <span class="n">allTasks</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">for</span> <span class="o">(</span><span class="nc">ScheduledTask</span> <span class="n">task</span> <span class="o">:</span> <span class="n">tasks</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">task</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">this</span><span class="o">.</span><span class="na">scheduledTasks</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">this</span><span class="o">.</span><span class="na">registrar</span><span class="o">.</span><span class="na">destroy</span><span class="o">();</span>
	<span class="o">}</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></div></div>

<h2 id="scheduledmethodrunnable"><span class="me-2">ScheduledMethodRunnable</span><a href="#scheduledmethodrunnable" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>任务执行方法,主要包括两个属性：</p>

<blockquote>
  <p>target–&gt; Spring 容器 bean实例</p>

  <p>method –&gt; Bean对象方法</p>
</blockquote>

<p>源码：</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre></td><td class="rouge-code"><pre><span class="cm">/*
 * Copyright 2002-2012 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="kn">package</span> <span class="nn">org.springframework.scheduling.support</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.UndeclaredThrowableException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.util.ReflectionUtils</span><span class="o">;</span>

<span class="cm">/**
 * Variant of {@link MethodInvokingRunnable} meant to be used for processing
 * of no-arg scheduled methods. Propagates user exceptions to the caller,
 * assuming that an error strategy for Runnables is in place.
 *
 * @author Juergen Hoeller
 * @since 3.0.6
 * @see org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScheduledMethodRunnable</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="n">target</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">;</span>


	<span class="kd">public</span> <span class="nf">ScheduledMethodRunnable</span><span class="o">(</span><span class="nc">Object</span> <span class="n">target</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">ScheduledMethodRunnable</span><span class="o">(</span><span class="nc">Object</span> <span class="n">target</span><span class="o">,</span> <span class="nc">String</span> <span class="n">methodName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">NoSuchMethodException</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">method</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="n">methodName</span><span class="o">);</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">getTarget</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">target</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Method</span> <span class="nf">getMethod</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">method</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">ReflectionUtils</span><span class="o">.</span><span class="na">makeAccessible</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">method</span><span class="o">);</span>
			<span class="k">this</span><span class="o">.</span><span class="na">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">target</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">InvocationTargetException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">ReflectionUtils</span><span class="o">.</span><span class="na">rethrowRuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">.</span><span class="na">getTargetException</span><span class="o">());</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalAccessException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">UndeclaredThrowableException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></div></div>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
    <div class="post-meta mb-3">
      <i class="far fa-folder-open fa-fw me-1"></i>
      
      <a href="/categories/spring/">Spring</a>
    </div>
    

    <!-- tags -->
    

    <div class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      ">
      <div class="license-wrapper">
        
        

        本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted me-1">分享</span>
  <span class="share-icons">
    
    
    

    
      
      <a
        href="https://twitter.com/intent/tweet?text=Spring%20Boot%20%E4%BB%BB%E5%8A%A1task%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20-%20%E5%85%AB%E4%B8%80%E8%8F%9C%E5%88%80&url=%2Fposts%2Fspring-boot-task-sources%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Twitter"
        target="_blank"
        rel="noopener"
        aria-label="Twitter"
      >
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    
      
      <a
        href="https://www.facebook.com/sharer/sharer.php?title=Spring%20Boot%20%E4%BB%BB%E5%8A%A1task%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20-%20%E5%85%AB%E4%B8%80%E8%8F%9C%E5%88%80&u=%2Fposts%2Fspring-boot-task-sources%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Facebook"
        target="_blank"
        rel="noopener"
        aria-label="Facebook"
      >
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    
      
      <a
        href="https://t.me/share/url?url=%2Fposts%2Fspring-boot-task-sources%2F&text=Spring%20Boot%20%E4%BB%BB%E5%8A%A1task%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20-%20%E5%85%AB%E4%B8%80%E8%8F%9C%E5%88%80"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Telegram"
        target="_blank"
        rel="noopener"
        aria-label="Telegram"
      >
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>

            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get the last 5 posts from lastmod list. -->

<div class="xiaoym-qrcode">
  <div class="xiaoym-qrcode-title">
    <h2>微信公众号(八一菜刀)</h2>
  </div>
  <div style="text-align: center;"><img src="/images/website/mp/qrcode.jpg" /> </div>
</div>














<section id="access-lastmod">
  <h2 class="panel-heading">最近更新</h2>
  <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
    
    
    
    
    <li class="text-truncate lh-lg">
      <a href="/posts/llm-start/">全面进击AI大模型、RAG领域</a>
    </li>
    
    
    
    
    <li class="text-truncate lh-lg">
      <a href="/posts/rag-inaction-java/">实战0-1,Java开发者也能看懂的大模型应用RAG开发实践</a>
    </li>
    
    
    
    
    <li class="text-truncate lh-lg">
      <a href="/posts/use-prompt-framework/">用好大模型?这5种实用的Prompt框架你一定要看看!</a>
    </li>
    
    
    
    
    <li class="text-truncate lh-lg">
      <a href="/posts/knife4j-insight-mvp/">Knife4jInsight平台版-MVP版本v1.0.0发布</a>
    </li>
    
    
    
    
    <li class="text-truncate lh-lg">
      <a href="/posts/spring-boot-conditional/">Spring Boot框架中如何优雅的注入实体Bean</a>
    </li>
    
  </ul>
</section>
<!-- #access-lastmod -->

              <!-- The trending tags list -->















  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/llm/">LLM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rag/">RAG</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rag%E5%AE%9E%E6%88%98/">RAG实战</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%9E%E6%88%98/">大模型实战</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">相关文章</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/swagger-bootstarp-ui-with-spring-boot/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1517328000"
  data-df="YYYY/MM/DD"
  
>
  2018/01/31
</time>

              <h4 class="pt-0 my-2">在Spring Boot中使用swagger-bootstrap-ui</h4>
              <div class="text-muted">
                <p>
                  





                  swagger-bootstrap-ui是基于swagger接口api实现的一套UI,因swagger原生ui是上下结构的，在浏览接口时不是很清晰,所以，swagger-bootstrap-ui是基于左右菜单风格的方式,适用与我们在开发后台系统左右结构这种风格类似,方便与接口浏览

GITHUB:https://github.com/xiaoymin/Swagger-Bootstrap-UI...
                </p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/swagger-bootstrap-ui-1.7.2-issue/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>swagger-bootstrap-ui 1.7.2 发布，前端 UI 实现</p>
    </a>
  

  
    <a
      href="/posts/vue-node-app-linux/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>在Linux操作系统上部署VUE开发的node应用</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'xiaoymin/xiaoymin.github.io',
      'data-repo-id': 'MDEwOlJlcG9zaXRvcnk3OTUzMjIxNw==',
      'data-category': 'Comments',
      'data-category-id': 'DIC_kwDOBL2Quc4CaKF6',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'zh-CN',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2023</time>
    <a href="https://twitter.com/xiaoymin">xiaoymin</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/llm/">LLM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rag/">RAG</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rag%E5%AE%9E%E6%88%98/">RAG实战</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%9E%E6%88%98/">大模型实战</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/zh.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.21.2/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

