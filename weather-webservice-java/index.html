<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.40.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Java调用天气Webservice的小应用 &middot; 八一菜刀</title>

  
  <link type="text/css" rel="stylesheet" href="https://xiaoymin.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://xiaoymin.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://xiaoymin.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://xiaoymin.github.io/css/hyde.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://xiaoymin.github.io/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://xiaoymin.github.io/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="八一菜刀" />

  
</head>

  <body class=" ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://xiaoymin.github.io/"><h1>八一菜刀</h1></a>
      <p class="lead">
       顺着生命的河流一起流淌,体会身边的每份感动和感悟. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="https://xiaoymin.github.io/">主页</a> </li>
      <li><a href="https://xiaoymin.github.io/blogs/"> 博客列表 </a></li><li><a href="https://xiaoymin.github.io/opensource/"> 开源软件 </a></li><li><a href="https://xiaoymin.github.io/softnews/"> 软件资讯 </a></li><li><a href="https://xiaoymin.github.io/about/"> 关于作者 </a></li>
    </ul>

    <p>&copy; 2018. All rights reserved. </p>
  </div>
</div>

    <div class="content container">
    <div class="post">
  <h1>Java调用天气Webservice的小应用</h1>
  <span class="post-date">2015-05-27</span>
  <p>废话不多说,直接贴代码：</p>

<p>CityReq.java</p>

<pre><code class="language-java">package com.weather;

import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlRootElement;

@XmlRootElement(name=&quot;getWeatherbyCityName&quot;,namespace=&quot;http://WebXml.com.cn/&quot;)
public class CityReq {

    private String theCityName;

    public String getTheCityName() {
        return theCityName;
    }

    @XmlElement(name=&quot;theCityName&quot;,namespace=&quot;http://WebXml.com.cn/&quot;)
    public void setTheCityName(String theCityName) {
        this.theCityName = theCityName;
    }

    
}
</code></pre>

<p>WeatherWebServiceTest.java</p>

<pre><code class="language-java">package com.weather;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;

import javax.xml.bind.JAXBContext;
import javax.xml.bind.Marshaller;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.soap.MessageFactory;
import javax.xml.soap.SOAPBody;
import javax.xml.soap.SOAPConstants;
import javax.xml.soap.SOAPEnvelope;
import javax.xml.soap.SOAPMessage;

import org.w3c.dom.Document;
public class WeatherWebServiceTest {

    public static void main(String[] args) {
        // TODO Auto-generated method stub
        weather();
    }
    static void weather(){
        System.out.println(&quot;开始登陆...&quot;);
        String wsdl=&quot;http://www.webxml.com.cn/WebServices/WeatherWebService.asmx?wsdl&quot;;
        System.out.println(&quot;wsdl:&quot;+wsdl);
        HttpURLConnection urlconn=null;
        InputStream ins=null;
        OutputStream ous=null;
        try {
            URL u=new URL(wsdl);
            urlconn=(HttpURLConnection)u.openConnection();
            urlconn.setDoOutput(true);
            urlconn.setRequestMethod(&quot;POST&quot;);
            urlconn.setRequestProperty(&quot;Content-Type&quot;, &quot;application/soap+xml; charset=utf-8&quot;);
            //urlconn.setRequestProperty(&quot;Content-Type&quot;, &quot;text/xml; charset=utf-8&quot;);
            
            //发送数据
            ous=urlconn.getOutputStream();
            
            
            Document document=DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
            //编组
            Marshaller marsh=JAXBContext.newInstance(CityReq.class).createMarshaller();
            CityReq xmlf=new CityReq();
            xmlf.setTheCityName(&quot;北京&quot;);
            //JAXB.marshal(xmlf, new PrintWriter(System.out));
            marsh.marshal(xmlf, document);
            //创建soapmessage对象
            SOAPMessage soapMessage=MessageFactory.newInstance(SOAPConstants.SOAP_1_2_PROTOCOL).createMessage();
            SOAPBody soapBody=soapMessage.getSOAPBody();
            soapBody.addDocument(document);
            SOAPEnvelope soapEnvelope = soapMessage.getSOAPPart().getEnvelope();
            soapEnvelope.removeNamespaceDeclaration(&quot;env&quot;);
            soapEnvelope.addNamespaceDeclaration(&quot;soap12&quot;, &quot;http://www.w3.org/2003/05/soap-envelope&quot;);
            soapEnvelope.addNamespaceDeclaration(&quot;xsi&quot;, &quot;http://www.w3.org/2001/XMLSchema-instance&quot;);
            soapEnvelope.addNamespaceDeclaration(&quot;xsd&quot;, &quot;http://www.w3.org/2001/XMLSchema&quot;);
            soapEnvelope.setPrefix(&quot;soap12&quot;);
            soapEnvelope.removeChild(soapEnvelope.getHeader());
            soapBody.setPrefix(&quot;soap12&quot;);
            //发送数据
           soapMessage.writeTo(ous);
           // soapMessage.writeTo(System.out);
            System.out.println(urlconn.getResponseCode());
            System.out.println(urlconn.getResponseMessage());
            //接收数据
            ins=urlconn.getInputStream();
            //接收的数据需要解组?
           StringBuffer respMsg=new StringBuffer();
            byte[] bytes=new byte[1024*1024];
            int a=-1;
            while ((a=ins.read(bytes))!=-1) {
                respMsg.append(new String(bytes,0,a));
            }
            System.out.println(respMsg.length());
            System.out.println(respMsg);
            
            //解组的方式
          /* SOAPMessage responseMessage=MessageFactory.newInstance(SOAPConstants.SOAP_1_2_PROTOCOL).createMessage(null, ins);
            Unmarshaller unmarsh=JAXBContext.newInstance(CityResp.class).createUnmarshaller();
            JAXBElement&lt;CityResp&gt; reponse= unmarsh.unmarshal(responseMessage.getSOAPBody().extractContentAsDocument(), CityResp.class);
            CityResp uresp= reponse.getValue();
            System.out.println(uresp.getResult());*/
            
            ous.close();
            ins.close();
            urlconn.disconnect();
        } catch (Exception e) {
            e.printStackTrace();
        }finally{
            
        }
    }
    
     
}
</code></pre>

</div>


    </div>

    
  </body>
</html>